{
\newcommand{\cat}[1]{\mathcal{#1}}
\newcommand{\theory}[1]{\mathbf{#1}}
\newcommand{\Psh}{\mathop{PSh}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\TT}{\theory{T}}
\newcommand{\EE}{\theory{E}}
\newcommand{\Com}{\theory{Com}}
\newcommand{\diffquot}[2]{\frac{\Delta{#1}}{\Delta{#2}}}

\subsection{Algebraic Theories}

Recall that an \emph{algebraic theory} \(\TT\) is a category whose underlying type of objects is the set \(\N\) of natural numbers, together with a choice of morphisms \(\pi^n_1,\dots,\pi^n_n : \TT(n,1)\) for each \(n : \N\) which exhibit \(n\) as an \(n\)-th power of \(1\) in \(\TT\).
Given an algebraic theory \(\TT\), a \emph{\(\TT\)-algebra object} in a category \(\cat C\) is a functor \(A:\TT\to\cat C\) which preserves finite powers, and a \emph{morphism} between two \(\TT\)-algebra objects in \(\cat C\) is a natural transformation.
The object \(A(1)\) is called the \emph{carrier} of the \(\TT\)-algebra object.
A \(\TT\)-algebra object in the category of sets (more precisely, in the category of \(\mU\)-small sets for a universe \(\mU\)) is simply called a \emph{\(\TT\)-algebra}.

\begin{remark}
  We also write \(\TT(n)\) for the set \(\TT(n,1)\) and refer to its terms as \emph{\(n\)-ary operations}.
  Since every object of an algebraic theory \(\TT\) is a finite power of \(1\), its universal property guarantees, that every morphism \(f:\TT(n,m)\) is uniquely determined by an \(m\)-tuple of \(n\)-ary operations \(f_1,\dots,f_m : \TT(n)\).
  Consequently, \(\TT\) is uniquely determined by the sets \(\TT(n)\) together with a composition operation which is associative and compatible with projection operations.
  Such a structure is also known as an \emph{(abstract) clone} of an algebraic theory.
\end{remark}

\begin{example}
Let \(R^0,R\equiv R^1,R^2,\dots\) be a sequence of objects of a category \(\cat C\) together with morphisms \(\pi^n_i : R^n \to R\) which exhibit \(R^n\) as an \(n\)-th power of \(R\).
We may assume that \(\pi^1_1 = \id_R\).
We define an algebraic theory \(\EE_R\) as follows: For its \(n\)-ary operations, set
\[\EE_R(n) \colonequiv \cat C(R^n,R).\]
The composition operation on \(\cat C\) then restricts to a composition operation on \(\EE_R\) which is associative and compatible with projections.
By the remark above, this defines an algebraic theory \(\EE_R\) called the \emph{endomorphism theory} of \(R\).
% It is easy to see that this datum uniquely specifies an algebraic theory \(\EE_R\) which we call the \emph{endomorphism theory} of \(R\).
Moreover, by mapping \(n\mapsto R^n\), there is a canonical fully faithful embedding \(\EE_R \hookrightarrow \cat C\) which allows us to regard \(\EE_R\) as the full subcategory of \(\cat C\) generated by the specified finite powers of \(R\).
\end{example}

\begin{remark}
  Every algebraic theory \(\TT\) is the endomorphism theory of its \emph{generic object} \(1:\TT\).
\end{remark}

\begin{example}
  Consider the opposite category of the category of commutative rings and let us write \(\ell A\) for the formal dual of a commutative ring \(A\).
  The polynomial ring \(\Z[X]\) over the integers admits finite copowers (the formally dual concept to powers).
  Namely, we can realize its \(n\)-th copower as the polynomial ring \(\Z[X_1,\dots,X_n]\) in \(n\) variables with coprojections given by \(X\mapsto X_i\).
  Therefore, the endomorphism theory \(\EE_{\ell\Z[X]}\) on its formal dual exists.
  % This theory is called the \emph{theory of commutative rings} and denoted by \(\Com\).

  The carrier of an algebra of this theory admits the structure of a commutative ring.
  For example, the addition operation is specified by the image of the dual of the map \(X\mapsto X_1+X_2\).
  Conversely, every commutative ring \(A\) gives rise to an algebra of \(\EE_{\ell\Z[X]}\) in the category of sets because every polynomial \(f\in\Z[X_1,\dots,X_n]\) (that is, a ring morphism \(\Z[X]\to\Z[X_1,\dots,X_n]\)) induces a (polynomial) map \(A^n\to A, \vec{a}\mapsto f(\vec{a})\), and this is obviously compatible with projections.
  One can extend this correspondence to an equivalence of categories between the category of commutative rings and the category of algebras for \(\EE_{\ell\Z[X]}\).
  It is thus reasonable to call \(\Com\colonequiv\EE_{\ell\Z[X]}\) the \emph{theory of commutative rings}.
\end{example}

\begin{itemize}
  \item\rednote{Free Algebras \(F_\TT(n)\)}
  \item\rednote{Quotients by congruences}
  \item\rednote{Finitely presented algebras}
\end{itemize}

Suppose \(\TT\) is any algebraic theory (for example, the theory of rings) and let \(\cat A\) be any full subcategory of the category of \(\TT\)-algebras in the category of sets (think of finitely presented algebras).
We write \(\cat L\) for the opposite category of \(\cat A\) and \(\ell A\) for the formal dual of a \(\TT\)-algebra \(A\) in \(\cat A\).
Moreover, we suppose \(\cat L\) is equipped with a subcanonical Grothendieck topology (for example, the Zariski topology).
Then let \(\cat T\) be the sheaf topos over \(\cat L\) and denote the Yoneda embedding \(\cat L\to\cat T\) by \(Y\).
Finally, we write \(F_\TT(n)\) for the free \(\TT\)-algebra on \(n\) generators and then consider the \emph{generic \(\TT\)-algebra} \(R\colonequiv Y\ell(F_{\TT}(1))\) in \(\cat T\).

\begin{proposition}
  The endomorphism theory of \(R\) is equivalent to the algebraic theory \(\TT\).
\end{proposition}
\begin{proof}
  For two natural numbers \(n,m:\N\) we calculate:
  \begin{align*}
    \EE_R(n,m)
    &= \cat T(R^n,R^m)\\
    &= \cat T(Y\ell(F_{\TT}(n)),Y\ell(F_{\TT}(m)))\\
    &= \Psh(\cat L)(Y\ell(F_{\TT}(n)),Y\ell(F_{\TT}(m)))\\
    &= \cat L(\ell(F_{\TT}(n)),\ell(F_{\TT}(m)))\\
    & = \cat A(F_{\TT}(m),F_{\TT}(n))\\
    & = \Alg{\TT}(F_{\TT}(m),F_{\TT}(n))\\
    & = \Alg{\TT}(\TT(m,\_),\TT(n,\_))\\
    & = [\TT,\Set](\TT(m,\_),\TT(n,\_))\\
    & = \TT(n,m)
  \end{align*}
Here, we used the fact that the free \(\TT\)-algebra on \(n\) generators is given by the representable functor \(\TT(n,\_)\).
The last equality is just the Yoneda embedding for copresheaves.
\end{proof}


\subsection{Fermat Theories}

Given two algebraic theories \(\TT\) and \(\TT'\), a \emph{theory morphism} \(\tau:\TT\to\TT'\) is a functor between their underlying categories which is the identity on objects and preserves projections.
The pair \((\TT,\tau)\) is called an \emph{extension} of the theory.

% \begin{remark}
%   Given an object \(R\) of a category \(\cat C\) with specified finite powers, theory morphisms \(\TT\to\EE_R\) are in bijection with \(\TT\)-algebra structures on \(R\).
% \end{remark}

To make the following definition more readable, let us introduce some notational conventions.
If we denote the projection operations \(\pi^n_i\) of an algebraic theory \(\TT\) by \(X_i\), leaving the arity \(n\) implicit, we may treat them as {variables} in the following sense:
By the universal property, we have \(\id_n = (X_1,\dots,X_n)\) in \(\TT(n,n)\).
Suppressing the composition symbol, any operation \(f : \TT(n)\) can thus be written as
\[f = f\circ \id_n = f \circ (X_1,\dots,X_n) = f(X_1,\dots,X_n) = f(\vec X),\]
where we employ vector notation \(\vec X \colonequiv (X_1,\dots,X_n)\) for the last equality.
Moreover, given morphisms \(g_1,\dots,g_n : \TT(m,n)\) we can resort to the usual substitution notation for composition, as is common in algebra:
\[f \circ (g_1,\dots,g_n) = f(g_1(X_1,\dots,X_m),\dots,g_n(X_1,\dots,X_m))\]
We also use different variable names instead of \(X_1,X_2,\dots\), for example \(X,Y,Z\).
Finally, assume that \(\TT\) is an extension of the theory of commutative rings, say \(\tau : \Com \to \TT\).
By abuse of notation, we suppress \(\tau\) and write \(0,+,-,1,\cdot\) for the usual ring operations inherited from \(\Com\).
Moreover, we use infix notation for addition and multiplication as is common in algebra.

\begin{definition}
  A \emph{Fermat theory} is an extension \(\TT\) of the theory \(\Com\) of commutative rings which satisfies the following property.
  For each \(f(X,\vec{Z}) : \TT(n+1)\) there exists a unique \(g(X,Y,\vec{Z}) : \TT(n+2)\) such that
  \[
    f(X,\vec{Z}) - f(Y,\vec{Z}) = (X-Y)\cdot g(X,Y,\vec{Z}).
  \]
  The operation \(g\) is called the \emph{difference quotient} or \emph{Fermat-Hadamard quotient} of \(f\) (with respect to the first argument).
  We also denote it by the symbol \(\diffquot{f}{X}\).
\end{definition}

Given an extension \(\tau:\Com\to\TT\) of the theory of commutative rings, a \(\TT\)-algebra canonically carries the structure of a commutative ring by precomposition with \(\tau\).
Accordingly, every morphism of \(\TT\)-algebras is already a homomorphism between the underlying commutative rings.
In particular, the free algebra \(R\colonequiv F_\TT(0)\) on zero generators is a commutative ring.
We call this the \emph{base ring} of the theory.
Since it is initial among all \(\TT\)-algebras, every \(\TT\)-algebra carries a canonical \(R\)-algebra structure.

\begin{proposition}
  Let \(A\) be an algebra over a Fermat theory \(\TT\) and \(I\) an ideal of the underlying ring of \(A\).
  There is a unique \(\TT\)-algebra structure on the quotient ring \(A/I\) such that the canonical ring morphism \(A \to A/I\) becomes a morphism of \(\TT\)-algebras which annihilates \(I\).
  Moreover, it is initial among all \(\TT\)-algebra morphisms \(A\to B\) which annihilate \(I\).
\end{proposition}
\begin{proof}
  See \cite[Proposition 1.2]{DK84} \rednote{check universal property?}.
\end{proof}

}
