\subsection{Preliminary work}

\rednote{Would be nicer to prove it for Stone spaces, and then generalise to Compact Hausdorff using abstract reasoning on quotients. This makes Lemmas 3.1.2 to 3.1.5 redundant}

\begin{lemma}\label{factorisation-stone-finite}
For any tower of Stone space $(S_k)_{k:\N}$ and $l:\N$, we have that:
\[\left(\mathrm{lim}_kS_k\to \mathrm{Fin}(l)\right) \simeq \mathrm{colim}_k (S_k\to \mathrm{Fin}(l))\]
\end{lemma}

\begin{proof}
We have that:
\[\left(\mathrm{lim}_kS_k\to \mathrm{Fin}(l)\right) \]
\[\simeq \Hom(2^l, \mathrm{colim}_k 2^{S_k})\]
\[\simeq \mathrm{colim}_k \Hom(2^l, 2^{S_k}) \]
\[\simeq \mathrm{colim}_k (S_k\to \mathrm{Fin}(l))\]
Where the third line comes from the fact that $2^l$ is finitely presented.
\end{proof}

We need to introduce a bit of notations:

Given a tower: 
\[X_0 \to X_1\to X_2\to \cdots \]
we write $i_l$ for the map $X_l\to\mathrm{colim_k}X_k$.

Given a tower: 
\[Y_0 \leftarrow Y_1\leftarrow Y_2 \leftarrow \cdots\]
we write $\pi_l$ the map $\lim_k Y_k\to Y_l$ and for $m\geq l$ we write $j_{m,l}$ the induced map $Y_m\to Y_l$.

\begin{lemma}\label{sequential-limits-decidable}
Assume given $(S_k)_{k:\N}$ a tower of Stone spaces and $l:\N$ with $P:S_l\to 2$ such that:
\[\forall (x:\mathrm{lim}_kS_k).\ P(\pi_l(x))\]
Then we have that:
\[\exists(m:\N).\ \forall(y:S_m).\ P(j_{m,l}(y))\]
\end{lemma}

\begin{proof}
The hypothesis means that the element corresponding to $P$ in $2^{S_l}$ is equal to $1$ in $\mathrm{colim}_k2^{S_k}$. So there exists $m$ such that it is equal to $1$ in $2^{S_m}$ which is what we want.
\end{proof}

\begin{lemma}\label{stonification-sequential-limits}
For any tower of compact Hausdorff spaces $(C_k)_{k:\N}$, we have that:
\[\Spec(2^{\mathrm{lim}_k C_k}) = \mathrm{lim}_k\Spec(2^{C_k})\]
\end{lemma}

\begin{proof}
By \cref{sequential-limit-Hausdorff} we have a pointwise surjective map of towers:
\begin{center}
\begin{tikzcd}
S_0\ar[d] & S_1\ar[d]\ar[l] & \cdots\ar[l]\\
C_0 & C_1\ar[l] & \cdots\ar[l]\\
\end{tikzcd}
\end{center}
where the $S_k$ are Stone, so that $C_k = S_k/R_k$ for some closed equivalence relation $R_k$. Then we want to show that the map:
\[\mathrm{colim}_k (C_k \to 2) \to (\mathrm{lim}_kC_k \to 2)\]
is an equivalence, or equivalently that the map:
\[\mathrm{colim}_k \{ f:S_k \to 2\ |\ f\ \mathrm{respects}\ R_k \}\to \{ g:\mathrm{lim}_kS_k \to 2\ |\ g\ \mathrm{respects}\ \forall k. R_k\}\]
is an equivalence. This in turn is equivalent to proving:
\[ \{ f : \mathrm{colim}_k (S_k \to 2)\ |\ \mathrm{colim}_k (f\ \mathrm{respects}\ R_k)\} \to \{ g:\mathrm{lim}_kS_k \to 2\ |\ g\ \mathrm{respects}\ \forall k. R_k\}\]
is an equivalence, where for $f:S_l\to 2$
\[\mathrm{colim}_k (i_l(f)\ \mathrm{respects}\ R_k)\]
means that there exists $m\geq l$ such that $f\circ j_{m,l}$ respects $R_m$.

But since by \cref{factorisation-stone-finite} we already know that the map:
\[\mathrm{colim}_k (S_k \to 2) \to (\mathrm{lim}_kS_k \to 2)\]
is an equivalence we just need to prove that the side conditions are equivalent.

Given $f:S_l\to 2$, if there exists $m\geq l$ such that $f\circ j_{m,l}$ respects $R_m$ it is clear that $f\circ \pi_l$ respects $\forall k. R_k$.

Conversely assume $f:S_l\to 2$ such that $f\circ \pi_l$ respects $\forall k. R_k$, this means that:
\[\forall x,y:\mathrm{lim}_k S_k. (\forall k. R_k(x_k,y_k) )\to f(\pi_l(x))=f(\pi_l(y))\]
So we have that:
\[\forall (z : \mathrm{lim}_k \Sigma(x,y:S_k).\ R_k(x,y)).\ f(\pi_l(\pi_1(z)))=f(\pi_l(\pi_2(z)))\]
and then we just apply \cref{sequential-limits-decidable} to conclude.
\end{proof}

\begin{lemma}
Assume $C$ compact Hausdorff and $S$ Stone. Then the map:
\[C\to \Spec(2^C)\]
induces an equivalence:
\[(\Spec(2^C) \to S) \simeq(C\to S) \]
\end{lemma}

\begin{proof}
First we prove that the map:
\[C\to \Spec(2^C)\]
is surjective. Assume $C$ is the quotient of $S$ Stone, then $2^C$ is a subalgebra of $2^S$ and both are c.p., therefore we by completeness we have an induced surjective map:
\[\Spec(2^S) = S\to C\to \Spec(2^C)\]
so the map:
\[C\to \Spec(2^C)\]
is surjective and the map:
\[(\Spec(2^C) \to S) \to (C\to S) \]
is injective as $S$ is a set. It is surjective as any map $C\to S$ induces a commutative square:
\begin{center}
\begin{tikzcd}
C\ar[d]\ar[r] & S\ar[d]\\
\Spec(2^C)\ar[r] & \Spec(2^S)
\end{tikzcd}
\end{center}
where the right map is an equivalence.
\end{proof}

\begin{lemma}\label{factorisation-compact-hausdorff-finite}
For any tower of compact Hausdorff $(C_k)_{k:\N}$ and $l:\N$, we have that:
\[\left(\mathrm{lim}_kC_k\to \mathrm{Fin}(l)\right) \simeq \mathrm{colim}_k (C_k\to \mathrm{Fin}(l))\]
\end{lemma}

\begin{proof}
By \cref{factorisation-stone-finite} and \cref{stonification-sequential-limits}.
\end{proof}

\begin{lemma}\label{overtly-discrete-union-open}
Assume $(I_i)_{i:\N}$ a tower of overtly discrete types. Then for any $i:\N$ we have that $\mathrm{Im}(I_i)$ is open in $\mathrm{colim}_i I_i$. 
\end{lemma}

\begin{proof}
For $y:\mathrm{colim}_iI_i$, we have that $y\in \mathrm{Im}(I_i)$ is:
\[\exists(x:I_i). x=_{\mathrm{colim}_iI_i}y\]
which is the propositional truncation of an overtly discrete type and therefore open.
\end{proof}

\begin{lemma}\label{factorisation-image-true-factorisation}
Assume given $C$ compact Hausdorff and for each $x:C$ a tower:
\[I_0(x)\to I_1(x)\to \cdots\]
of overtly discrete types. Given:
\[f:\Pi_{x:S}\mathrm{colim}_i I_i(x)\]
such that there exists $i:\N$ such that $f$ factors through $\mathrm{Im}(I_i)$. Then there exists $j\geq i$ such that $f$ factors through $I_j$.
\end{lemma}

\begin{proof}
By local choice there exists a surjective map:
\[p:S\to C\]
with:
\[g:\Pi_{x:S} I_i(p(x))\]
such that:
\[\forall(x:S). g(x) =_{\mathrm{colim}_i I_i(x)} f(p(x))\]
Then we have that:
\[\forall(x,y:S). p(x)=p(y) \to g(x) =_{\mathrm{colim}_i I_i(x)} g(y)\]
so that:
\[\forall(x,y:S). p(x)=p(y) \to \exists(i:\N). g(x) =_{I_i(x)} g(y)\]
Since $\Sigma(x,y:S). p(x)=p(y)$ is compact Hausdorff we can apply \cref{compact-hausforff-countable-cover} to get a $j:\N$ such that:
\[\forall(x,y:S). p(x)=p(y) \to g(x) =_{I_j(x)} g(y)\]
which gives a factorisation of $f$ through $I_j$.
\end{proof}

\begin{proposition}\label{scott-continuity-right}
Assume given $C$ compact Hausdorff and for each $x:C$ a tower:
\[I_0(x)\to I_1(x)\to \cdots\]
of overtly discrete types. Then we have that:
\[\Pi_{x:C} \mathrm{colim}_{i} I_i(x) = \mathrm{colim}_{i} \Pi_{x:C} I_i(x)\]
\end{proposition}

\begin{proof}
Let us check that the canonical map:
\[\mathrm{colim}_i \Pi_{x:C} I_i(x) \to \Pi_{x:C} \mathrm{colim}_i I_i(x) \]
is an equivalence. 

First we check that it is injective. Given $f,g:\Pi_{x:C} I_i(x)$ such that:
\[\forall(x:C).  f(x) =_{\mathrm{colim}_iI_i(x)} g(x)\]
Then we have that:
\[\forall(x:C).  \exists(i:\N). f(x) =_{I_i(x)} g(x)\]
so that by \cref{compact-hausforff-countable-cover} we have that:
\[\exists(j:\N). \forall(x:C). f(x) =_{I_j(x)} g(x)\]
which precisely means that $f=g$ in $\mathrm{colim}_i \Pi_{x:C} I_i(x)$.

Now we check that it is surjective. Given a map:
\[f: \Pi_{x:C} \mathrm{colim}_i I_i(x)\]
we know that:
\[\forall(x:C). \exists(i:\N). f(x)\in \mathrm{Im}(I_i(x))\]
but $f(x)\in \mathrm{Im}(I_i(x))$ is open by \cref{overtly-discrete-union-open} so that by \cref{compact-hausforff-countable-cover} we have that:
\[\exists(i:\N). \forall(x:C).  f(x)\in \mathrm{Im}(I_i(x))\]
which precisely mean that $f$ factors through $\mathrm{Im}(I_i)$ for some $i$. We conclude by \cref{factorisation-image-true-factorisation}.
\end{proof}

\begin{proposition}\label{scott-continuity}
Assume given $(C_k)_{k:\N}$ a tower of compact Hausdorff spaces and $(I_i)_{i:\N}$ a tower of overtly discrete types. Then:
\[\left( \mathrm{lim}_k C_k \to \mathrm{colim}_i I_i\right) \simeq \mathrm{colim}_{k,i} (C_k\to I_i)\]
\end{proposition}

\begin{proof}
By the non-dependent version of \cref{scott-continuity-right} we just have to prove that for any overtly discrete $I$ we have that:
\[(\mathrm{lim}_kC_k\to I) \simeq \mathrm{colim}_k(C_k\to I)\]
so it is enough to prove that for all towers of finite type we have that:
\[(\mathrm{lim}_kC_k\to \mathrm{colim}_i\mathrm{Fin}(n_i)) \simeq \mathrm{colim}_k(C_k\to \mathrm{colim}_i\mathrm{Fin}(n_i))\]
but we can see that by using \cref{scott-continuity-right} and \cref{factorisation-compact-hausdorff-finite}.
\end{proof}

\begin{remark}
A consequence of Scott continuity is that given a family $(S_k)_{k:\N}$ and $I$ overtly discrete, for any map:
\[f: \left(\Pi_{k:\N} S_k\right) \to I\]
there merely exists $n:\N$ such that $f$ factors through:
\[\Pi_{k:\mathrm{Fin}(n)} S_k\]
which justifies the name.
\end{remark}


\subsection{Tychonov and its dual}

\begin{theorem}[Tychonov]
Assume given $I$ overtly discrete and $C_i$ compact Hausdorff depending on $i:I$. Then:
\[\prod_{i:I}C_i\]
is compact Hausdorff.
\end{theorem}

\begin{proof}
We can assume $I = \mathrm{colim}_{k:\N}\mathrm{Fin}(l_k)$. Then:
\[\prod_{i:I}C_i = \prod_{i:\mathrm{colim}_{k:\N}\mathrm{Fin}(l_k)} C_i = \lim_{k:\N} C_i^{l_k}\]
and we can conclude using that compact Hausdorff spaces are stable under sequential limits and finite products.
\end{proof}

\begin{lemma}\label{tychonov-dual-auxiliary}
Assume $p:C\to D$ a surjective map with $C$ and $D$ compact Hausdorff. Given $I_x$ overtly discrete depending on $x:D$, if:
\[\prod_{x:C}I_{p(x)}\]
is overtly discrete then so is:
\[\prod_{x:D}I_x\]
\end{lemma}

\begin{proof}
Since the map is surjective we have an embedding:
\[\prod_{x:D}I_x\subset \prod_{x:C}I_{p(x)}\]
But the fiber over $g:\prod_{x:C}I_{p(x)}$ is:
\[\forall (x,y:C). p(x)=p(y) \to g(x)=g(y)\]
which is open by \cref{compact-hausdorff-compact}.
\end{proof}

\begin{theorem}[Tychonov's dual]\label{tychonov-dual}
Assume given $C$ compact Hausdorff and $I_x$ overtly discrete depending on $x:C$. Then:
\[\prod_{x:C}I_x\]
is overtly discrete.
\end{theorem}

\begin{proof}
By local choice and \cref{tychonov-dual-auxiliary} we can assume that $C$ is Stone (so we denote $C$ by $S$) and that we have towers of finite types $(\mathrm{Fin}(l_{k,x}))_{k:\N}$ such that for all $x:S$ we have that:
\[I_x = \mathrm{colim}_k\mathrm{Fin}(l_{k,x})\] 
Then using \cref{scott-continuity-right} and the fact that overtly discrete types are stable under sequential colimits, it is enough to prove that for $S$ Stone and $l_x:\N$ depending on $x:S$ we have that:
\[\prod_{x:S}\mathrm{Fin}(l_{x})\]
is overtly discrete. 

Using boundedness, the fact that:
\[S_k = \left(\Sigma_{x:S} l_x = k\right)\] 
is Stone and that overtly discrete types are stable under finite products, we just have to prove that for any $l:\N$ and $S$ Stone we have that:
\[S\to \mathrm{Fin}(l)\]
is overtly discrete. We can conclude using that \cref{factorisation-stone-finite} and that Stone are limits of finite types.
\end{proof}


\subsection{The general version of Scott continuity}

So far we have two versions of Scott continuity (\Cref{scott-continuity-right} and \Cref{scott-continuity}), neither clearly implying the other. We give a common generalisation, suggested to me (Hugo) by Reid Barton.

\begin{definition}
We have a category $\mathcal C$ defined by:
\begin{itemize}
\item An object consists of $X:\CHaus$ and $I:X\to \ODisc$.
\item A morphism from $(X,I)$ to $(Y,J)$ consists of $f:Y\to X$ with $\forall y:Y.\ I_{f(x)}\to J_x$.
\end{itemize}
\end{definition}

The arrows are oriented such that we have a covariant functor $\Pi:{\mathcal C}\to \ODisc$.

\begin{theorem}[Die Eine Scott Continuity]
The functor:
\[\Pi : {\mathcal C} \to \ODisc\]
commutes with sequential colimits.
\end{theorem}

\begin{proof}
We assume given a tower in $\C$, that is we assume a tower:
\[C_0 \overset{p_0}{\leftarrow} C_1 \overset{p_0}{\leftarrow} C_2 \overset{p_2}{\leftarrow}\cdots \]
in $\CHaus$ with for all $k:\N$ a dependent type $I_k:C_k\to \ODisc$ and:
\[q_k : \Pi_{x:C_{k+1}}I_k(p_k(x))\to I_{k+1}(x)\]
We want to prove the canonical map:
\[\mathrm{colim}_i (\Pi_{x:C_i}I_i(x)) \to \Pi_{x\mathrm{lim}_kC_k}\mathrm{colim}_i I_i(x_i))\]
is an equivalence. 

By general reasoning on colimits, we know that the source is equivalent to:
\[\mathrm{colim}_{i,k\geq i} \Pi_{x:C_k} I_i(x_i)\]
which is the same as:
\[\mathrm{colim}_{i,k\geq i} \Pi_{x:C_i}\Pi_{y:C_k} y_k=x \to I_i(x)\]
which by \Cref{scott-continuity-right} is in turn equal to:
\[\mathrm{colim}_i\Pi_{x:C_i} \mathrm{colim}_{k\geq i} \Pi_{y:C_k} y_i = x \to I_i(x)\]
which by \Cref{scott-continuity} is equal to:
\[\mathrm{colim}_i\Pi_{x:C_i} \Pi_{y:\mathrm{lim}_{k\geq i} C_k} y_i=x \to I_i(x)\]
which is immediately seen as:
\[\mathrm{colim}_i\Pi_{x:\mathrm{lim}_{k} C_k} I_i(x_i)\]
which by \Cref{scott-continuity-right} is equal to:
\[\Pi_{x:\mathrm{lim}_{k} C_k} \mathrm{colim}_i I_i(x_k)\]

We omit the checking that this is indeed the canonical map.
\end{proof}

