

Classically, there is no abelian category of coherent $\mathcal O_X$-modules over a general base.
Synthetically, the category of finitely presented modules over $R$ does not have all kernels,
since $R$ is not coherent, so module bundles with values in finitely presented modules are not abelian.

This section is about finding a suitable replacement category.
This section is joint work of Felix Cherubini, Dan Christensen and Thomas ThorbjÃ¸rnsen.
\rednote{This is work in progress and "coherent" is a bad, preliminary name for the modules introduced in this section.}

\begin{theorem}
  For an $R$-module $M$ let $M^\ast\colonequiv \Hom_{\Mod{R}}(M,R)$ be its dual.
  Then dualizing a finite co-presentation of $M$:
  \[ M \hookrightarrow R^n \to R^m \]
  yields a finite presentation:
  \[ R^m \to R^n \twoheadrightarrow M^\ast \]
  This induces an anti-equivalence between finitely presented $R$-modules and finitely co-presented $R$-modules. In particular, the canonical map into the double dual, $M\to M^{\ast\ast}$ is an isomorphims for finitely presented and finitely co-presented $R$-modules.
\end{theorem}

\begin{proof}
  \cite{diffgeo-article}
\end{proof}


\begin{lemma}
  \label{presentation-extension}
  Let $M,N$ be finitely presented and $f:M\to N$.
  Then there is an extension of this morphism to all presentations of $M$ and $N$:
  \begin{center}
    \begin{tikzcd}
      R^{m'}\ar[r]\ar[d,dotted,"\exists"] & R^m\ar[->>,r,"\pi_M"]\ar[d,dotted,"\exists"] & M\ar[d, "f"] \\ 
      R^{n'}\ar[r] & R^n\ar[->>,r,"\pi_N"] & N \\ 
    \end{tikzcd}
  \end{center}
  By dualizing, the analogous statement holds for finitely co-presented modules.
\end{lemma}

\begin{proof}
  By linear extension: For a standard basis vector $e_i:R^m$ we merely have $y:R^n$ such that $\pi_N(y)=f(\pi_M(e_i))$. By exactness, we also get $R^{m'}\to R^{n'}$ by linear extension.
\end{proof}

\begin{lemma}
  \label{kernel-fp-is-cok-fcp}       
  Let $f:M\to N$ be a map of finitely presented $R$-modules, then $\ker f$ is the cokernel of map between finitely copresented $R$-modules.
\end{lemma}

\begin{proof}
  By \Cref{presentation-extension} we can assume $f$ is induced by a square and we construct finitely copresented modules $A,B$ like described below:
  \begin{center}
  \begin{tikzcd}
    A\ar[r,"\pi_1"]\ar[d,"l\times\id"] & R^{m'}\ar[r,"t"]\ar[d,"l"] & R^{n'}\ar[d,"r"]   \\
    B\ar[r,"\pi_1"]\ar[d] & R^m\ar[r,"b"]\ar[d] & R^n\ar[d] \\
    K\ar[r] &M\ar[r,"f"] & N
    \end{tikzcd}
   \end{center}
   $A:=\{(z,y):R^{m'}\times R^{n'}\mid blz=ry\}$, $B:=\{(x,y):R^{m}\times R^{n'}\mid bx=ry\}$.
\end{proof}

Due to lack of a better name, we call the following modules coherent --
the idea is that they might yield an analogue of the algebro-geometric notion of coherent sheaf of modules

\begin{definition}
  Let $M$ be an $R$-module, then $M$ is called coherent if one of the following equivalent statements hold:
  \begin{enumerate}[(i)]
  \item $M$ is merely the kernel of a homomorphism of finitely presented $R$-modules.
  \item $M$ is merely the cokernel of a homomorphism of finitely copresented $R$-modules.
  \item $M$ is the image of a map from a finitely co-presented $R$-module to a finitely presented $R$-module.
  \item $M$ is in the smallest abelian subcategory of $\Mod{R}$ that contains all finite free $R$-modules.
  \end{enumerate}
\end{definition}
We will show the equivalence of statement (iii) and the first two in ??.
The equivalence with (iv) will follow from \Cref{coherent-R-modules-abelian}.
(iii) will turn out to be self-dual.

\begin{remark}
  Any coherent $R$-module is wqc (\cite{draft}[Definition 7.1.5]).
\end{remark}

\begin{proof}
  By \cite{draft}[7.1.6, 7.1.13], the category of wqc $R$-modules is abelian and it contains finite free $R$-modules.
\end{proof}

\begin{lemma}
  \label{coherent-double-dual-mono}
  For any coherent $R$-module $K$, the double dualization map $K\to K^{\ast\ast}$ is a monomorphism.
\end{lemma}

\begin{proof}
  Let $A$ and $B$ be finitely co-presented $R$-modules with a homomorphism $f:A\to B$ such that $K$ is the kernel, then we have the following diagram, which we will explain below:
\begin{center}
\begin{tikzcd}
  B\ar[r,"\sim"] & B^{\ast\ast} \\   
  A\ar[r,"\sim"]\ar[u,"f"] & A^{\ast\ast}\ar[u,"f^{\ast\ast}"] \\   
  K\ar[r,"i"]\ar[u,hook]\ar[ur,hook] & K^{\ast\ast}\ar[u]\ar[l,dotted,bend left=20,"p"] \\   
\end{tikzcd}
\end{center}
$K$ is also the kernel of $f^{\ast\ast}$ by the indicated composition.
By the universal property of this kernel, the dotted map exists and we have $p\circ i=\id$.
\end{proof}

\begin{lemma}
  \label{maps-into-coherent-lift}
  Let $A$ and $B$ be finitely co-presented $R$-modules, $K$ be a coherent $R$-module and $e:A\to K$ a epimorphism.
  Then there is a lift for any homorphism $f:A\to K$.
    \begin{center}
      \begin{tikzcd}
         & C\ar[d,->>,"e"] \\
       A\ar[r,"f"]\ar[ru,dotted,"\exists"] & K 
      \end{tikzcd}
    \end{center}
\end{lemma}

\begin{proof}
  We will proof the lemma using the following steps:
  \begin{enumerate}[(i)]
  \item \label{coherent-fcp-lift-existence} There is a lift on the level of the underlying sets, i.e.\ a map $\tilde{f}$ as indicated in the commutative diagram, which is not necessarily $R$-linear:
    \begin{center}
      \begin{tikzcd}
         & C\ar[d,->>,"e"] \\
       A\ar[r,"f"]\ar[ru,dotted,"\exists \tilde{f}"] & K 
      \end{tikzcd}
    \end{center}
  \item Any lift $\tilde{f}$ from \ref{coherent-fcp-lift-existence} can be decomposed into a $R$-linear part $f_L:A\to C$, and a non-linear part $f_{NL}\coloneq\tilde{f}-f_L$.
  \item $e$ maps $f_{NL}$ to $0$, so $f_L$ is a $R$-linear lift.
  \end{enumerate}
  Will we ill now proof these statements.
  \begin{enumerate}[(i)]
  \item Let $M$ be the kernel of $e$, then $M$ is wqc.
  By \cite{draft}[Theorem 7.3.6] we have $H^1(A,M)=0$, since $A$, like any finitely co-presented $R$-module, is an affine scheme.

  By definition, we have $H^1(A,M)=||A\to K(M,1)||_0$ and therefore that $A\to K(M,1)$ is connected.
  For $x:K$ let $E_x$ denote the fiber of $e$ over $x$, then $E_x$ is a $M$-torsor or in other words an element of $K(M,1)$.
  So $E\circ f:A\to K(M,1)$ and we have $|| E\circ f = (\_\mapsto M) ||$ by the connectedness noted above.
  This means that the dependent type $E\circ f$ merely has a section, since $(\_\mapsto M)$ has a section.
  This proves existence of the dotted map.
  \item By \cite{diffgeo-article}, we know that the differential of $\tilde{f}$ is such a linear map,
  but a direct computation is also possible, which we will carry out in the following.
  
  Let $A$ and $C$ be given by $A=\Spec R[X_1,\dots,X_n]/(P_1,\dots,P_r)$ and $B=\Spec R[Y_1,\dots,Y_m]/(Q_1,\dots,Q_s)$.
  $\tilde{f}$ is represented by a homomorphism $\varphi$ between these $R$-algebras.
  Choosing lifts of the finitely many $\varphi(Y_i)$ we get polynomials $N_1,\dots,N_m$
  such that for all $j$ we have $Q_j(N_1,\dots,N_m)\in (P_1,\dots,P_r)$.
  Let $L_1,\dots,L_m$ be given by the linear parts of $N_1,\dots,N_m$.
  Then by analysing the degrees of the involved polynomials, we have $Q_j(L_1,\dots,L_m)\in (P_1,\dots,P_r)$, so the $L_1,\dots,L_m$ induce a homorphism
  \[
  \varphi_L: R[Y_1,\dots,Y_m]/(Q_1,\dots,Q_s) \to R[X_1,\dots,X_n]/(P_1,\dots,P_r)
  \]
  which induces a linear map $f_L:A\to B$.
  Let us note that the difference $f_{NL}\coloneq \tilde{f}-f_L$ is given by monomials $S_i$ which are all of degree at least two.
  \item We know that $e\circ \tilde{f}$ is a linear map, so $e\circ f_{NL}$ is linear as well.
  Let $f_{NL}=\sum_i S_i$ be a decomposition into monomials with degrees $n_i\geq 2$ as above.
  For all $t:R$ and $x:A$ we have
  \[
  \sum_i te(S_i(x))=te(\sum_i S_i(x))=e(\sum_i S_i(tx))=e(\sum_i t^{n_i}S_i(x))=\sum_i t^{n_i}e( S_i(x))
  \]
  So by taking the difference we have a polynomial $P(t)\coloneq \sum_i te(S_i(x))-\sum_i t^{n_i}e( S_i(x))$ in $t$ with coefficients in $K$, such that $P(t)=0$ for all $t$.
  Since all $e(S_i(x))$ appear as coefficients of $P$, we can conclude $e\circ f_{NL}=0$, from $P$ being zero.

  Let $f:K\to R$ be an arbitrary linear map, then $f(P(t)):R\to R$ has to be the zero polynomial,
  so $f$ maps all $e(S_i(x))$ to zero.
  This means that the double dualization $K\to K^{\ast\ast}$ maps each $e(S_i(x))$ to zero,
  but by \Cref{coherent-double-dual-mono} it is injective, so all $e(S_i(x))$ are zero.
  \end{enumerate}
\end{proof}

\begin{lemma}
  \label{coherent-kernels}
  The cokernel of a homomorphism between coherent $R$-modules is coherent.  
\end{lemma}

\begin{proof}
  Let $K,L$ be coherent $R$-modules and $f:K\to L$ a homomorphism.
  Choose finitely co-presented $R$-modules $A,B,C,D$ and homomorphisms to present $K$ and $L$ as cokernles.
  By the preceeding \Cref{maps-into-coherent-lift} there are lifts yielding this diagram:
  \begin{center}
    \begin{tikzcd}
      A\ar[d]\ar[r,dotted] & C\ar[d,"r"] & \\
      B\ar[d,->>]\ar[r,dotted,"b",swap] & D\ar[d,->>]\ar[rd,->>,"g"] & \\
      K\ar[r,"f",swap] & L\ar[r,->>,"\mathrm{cok}",swap] & \mathrm{Cok}
    \end{tikzcd}
  \end{center}
  Now we conclude by showing that the composition $g$ is the cokernel of a homorphism of the finitely co-presented $R$-modules $B\oplus C$ and $D$.
  By diagram-chasing, $b\oplus r:B\oplus C\to D$ surjects onto the kernel of $g$.
\end{proof}

\begin{lemma}
  \label{fp-kernel-dual-surjective}
  Let $M,N$ be finitely presented $R$-modules, $f:M\to N$ a homomorphism and $K$ its kernel,
  then the dual of the canonical map $K\to M$ is surjective.
\end{lemma}

\begin{proof}
  It is possible \rednote{TODO: add construction} to construct a diagram of the following shape, where the two left columns and all rows are exact:
  \begin{center}
    \begin{tikzcd}
      A\ar[r,hook]\ar[d] & R^{m_1}\ar[r,"t"]\ar[d,"l"] & R^{n}\ar[d,"\id"] \\
      B\ar[r,hook]\ar[d,->>] & R^{m_2}\ar[r,"b"]\ar[d,->>] & R^{n} \\
      K\ar[r,hook] & M\ar[r] & N
    \end{tikzcd}
  \end{center}
  Then a linear map $L:K\to R$ restricts to a map $L_1:B\to R$ which is zero on $A$.
  By \cite{diffgeo-article}[Lemma 2.3.7] it is possible to extend $L_1$ to $L_2:R^{m_2}\to R$.
  $L_2$ will descend to $M$, if and only if it vanishes on the image of $r$.
  This will generally not be the case, but we can construct a linear correction $c:R^{m_2}\to R$ such that $L_2-c$ has this property.

  To construct $c$, let $c_0\coloneq L_2\circ l$, note that $c_0$ vanishes on $A$ and therefore extends to the image of $t$, to a linear map $c_1:\mathrm{im}(t)\to R$.
  By \cite{diffgeo-article}[Lemma 2.3.8], $c_1$ extends to a map $c_2:R^{n}\to R$.
  Now $c\coloneq c_2\circ b$ is a linear map on $R^{m_2}$, that is zero on $B$,
  so $L_2-c$ is still an extension of $L_1$ and $L_2-c$ vanishes on $A$.
\end{proof}

\begin{theorem}
  \label{coherent-self-dual}
  Let $K$ be a coherent $R$-module, then the canonical map $K\to K^{\ast\ast}$ is an isomorphism.
  In particular, dualization is an anti-equivalence of the category of coherent $R$-modules.
\end{theorem}

\begin{proof}
  We can assume $K$ is in a sequence of $R$-modules:
  \begin{center}
    \begin{tikzcd}
      A\ar[r,"f"] & B\ar[r,->>] & K
    \end{tikzcd}
  \end{center}
  where $A,B$ are finitely co-presented and $B\to K$ is the cokernel of $f$.
  Taking double duals and using \Cref{fp-kernel-dual-surjective} and \Cref{coherent-double-dual-mono} we end up in this situation:
  \begin{center}
    \begin{tikzcd}
      A\ar[r,"f"] & B\ar[r,->>]\ar[d,"\sim"] & K\ar[d,hook] \\
      & B^{\ast\ast} \ar[r,->>] & K^{\ast\ast} 
    \end{tikzcd}
  \end{center}
  So $K\to K^{\ast\ast}$ is an isomorphism.
\end{proof}

\begin{theorem}
  \label{coherent-R-modules-abelian}
  \rednote{TODO: Check all proofs that go into this} The category of coherent $R$-modules is abelian.
\end{theorem}

\begin{proof}
  By \Cref{coherent-kernels} coherent $R$-modules are closed under kernels.
  By the duality from \Cref{coherent-self-dual}, this also shows the closure under cokernels.
\end{proof}

\begin{remark}
  \label{hom-closure}
  For coherent $R$-modules $M,N$, the $R$-module $\Hom_{\Mod{R}}(M,N)$ is coherent.
\end{remark}

\begin{proof}
  In \cite{lombardi-quitte}[Chapter IV, 4.12], ``coherent'' means something else, but their proof can still be applied twice to show the statement of the remark as follows.
  
  First we use their proof to show that for finitely presented $R$-modules $M,N$ the $R$-module $\Hom_{\Mod{R}}(M,N)$ is coherent. Morphisms $f:M\to N$ are presented by squares:
  \begin{center}
  \begin{tikzcd}
        R^m \ar[r]\ar[d,"\varphi"] & R^{m'}\ar[d,"\psi"] \\
        R^n\ar[r] & R^{n'}
\end{tikzcd}
\end{center}
  So we have a finite free module of pairs of morphisms $(\varphi,\psi)$ and a submodule of pairs such that the square above commutes.
  This submodule $S$ is the kernel of a linear map and therefore coherent.
  We have a surjection $\pi:S\to \Hom_{\Mod{R}}(M,N)$, so $\Hom_{\Mod{R}}(M,N)$ is coherent,
  if $\pi$ is a cokernel of a map of coherent modules.
  This is the case, since there is a surjection onto $\ker{\pi}$ from the finite free $R$-module of linear maps which splitting the square:
  \begin{center}
  \begin{tikzcd}
        R^m \ar[r]\ar[d,"\varphi"] & R^{m'}\ar[d,"\psi"]\ar[ld,"s"] \\
        R^n\ar[r] & R^{n'}
\end{tikzcd}
\end{center}
  Then we can reuse the same argument to show the statement of the remark.
\end{proof}

\paragraph{Questions:}
\begin{enumerate}
\item Is dualization an antiequivalence of coherent modules?
\item Are coherent modules closed under extension?
\item Are coherent modules closed under $\Hom$?
\item Are coherent modules closed under $\_\otimes\_$?
\item \label{coherent-local} Is a locally coherent $R$-module coherent?
\item Are projective/proper/finite-scheme products of coherent modules coherent?
\item Are the cohomology groups of coherent module bundles on projective schemes coherent?
\end{enumerate}

\paragraph{Answers:}
\begin{enumerate}
\item \begin{enumerate}[(i)]
\item Partial answer: At the very least, dualization is a functor on coherent modules.
We get that from \cref{hom-closure}, or independently with the following argument:
Any coherent $M$ can be written as a cokernel of finitely copresented modules:
\[ A \to B \to M \to 0 \]
By the properties of cokernels, the dual is exact:
\[ 0\to M^\vee \to B^\vee \to A^\vee \]
with $B^\vee$ and $A^\vee$ finitely presented. So $M^\vee$ is coherent.
\item For abstract reasons, cokernels dualize to kernels.
\end{enumerate}
\item None so far
\item Yes, \cref{hom-closure}.
\item It could be possible to just use the result for finitely presented modules, by extending the extension properties above to bilinear maps.
\item None so far
\item Partial answer:
\begin{enumerate}[(i)]
\item Let $X$ be a finite scheme, i.e. $X$ an affine scheme such that $R^X$ is a finitely presented $R$-module.
  For any coherent $R$-module $M$, $M^X$ is coherent: We can exponentiate the diagram witnessing coherence.
  Exponentiating is left exact and since $M$ is wqc and $X$ affine, it is also right exact.
\item Let $M:X\to \Mod{R}_{\mathrm{coh}}$ for a finite scheme $X$. Then $(x:X)\to M_x$ would be a coherent $R$-module, if we have \cref{coherent-local}: By local choice, we get a cover $D(f_1),\dots,D(f_n)$ of $X$, such that coherence of $M$ is witnessed by a diagram $M\hookrightarrow N \to L$ with $N,L$ finitely presented. By \cite{draft}[Theorem 7.2.3], $(x:D(f_i))\to N_x$ and $(x:D(f_i))\to L_x$ are finitely presented $R^{D(f_i)}$-modules and therefore finitely presented $R$-modules and the dependent product is a left exact functor.
\end{enumerate}
\item None so far. It seems a bit much to ask, but it would be really great for Serre-Duality, so it should be worth it to try to adapt e.g.\ \cite[19.1.3]{vakil}.
\end{enumerate}
