
\subsection{Reduced schemes (obsolete?)}

\rednote{What follows is a not completely satisfactory candidate definition of reduced schemes. Marc Nieper-Wißkirchen and Fabian Endres were involved in finding this notion.}

There is a \emph{candidate} definition of reduced schemes.
The analogue to the classical definition, that an affine scheme is reduced,
if its algebra of functions is reduced, is expected to be useless in the synthetic setup.
We start with a notion which is only suitable for affine schemes\footnote{An example where this fails for general schemes, is $V(X^2)\subseteq\bP^2$.}.

\begin{definition}\label{candidate-reduced}
  An affine scheme $X=\Spec A$ is \notion{reduced},
  if for all functions $f:A$, nilpotency implies $\neg\neg (f=0)$.
\end{definition}

An alternative, stronger criterion would be that if $f : A$ is nilpotent, then
$f = r_1 a_1 + \ldots + r_n a_n$ with $r_i : R$ nilpotent and $a_i : A$.

\begin{example}
  \begin{enumerate}[(a)]
  \item $\D(1)$ is not reduced.
    The algebra of functions is $R+\varepsilon R$ and we know that $\varepsilon$ is nilpotent and non-zero.
  \item $\A^1$ is reduced. To see this, let $f:R[X]$ be nilpotent.
    Then all coefficients of $f$ are nilpotent and since we prove a double-negation,
    we can assume they are zero.
  \item A basic open $D(f)$ of an affine reduced scheme is reduced:
    If $\left(\frac{a}{f^l}\right)^n=0$, we want to show $\neg\neg \frac{a}{f^l} = 0$.
    Since we want to show a double negated proposition, we can decide if $f$ is regular or nilpontent.
    If it is regular, $f^ka^n=0$ implies $\neg\neg a = 0$ and if it is nilpotent, every function on $D(f)$ is $0$ anyway.
  \item Any closed dense proposition, i.e.\ affine scheme of the form $\Spec (R/(\varepsilon_1,\dots,\varepsilon_n))$ is reduced.
  \item The cross with one infinitesimal axis $\Spec R[X,Y]/(XY,Y^2)$ is not reduced, since $Y$ is a nilpotent, non-zero function.
  \end{enumerate}
\end{example}

From a notion of ``reduced'' for general schemes, we would expect that it is closed under
\begin{enumerate}[(i)]
\item taking open subtypes
\item and finite open unions.
\end{enumerate}

For the notion of affine reduced scheme from above, (i) holds for basic opens of affines,
which is enough to make the following definition well-defined and fulfill the requirements above:

\begin{definition}
  A scheme $X$ is \notion{reduced} if there is a finite affine open cover $X=\bigcup_i U_i$ such that each $U_i$ is reduced.
\end{definition}

In fact, if there is one cover, any cover will be reduced.

\begin{remark}
  For a reduced scheme $X$ we have:
  \begin{enumerate}[(i)]
  \item Any open $U\subseteq X$ is reduced.
  \item For any finite open affine cover of $X=\bigcup U_i$, all $U_i$ are reduced.
  \end{enumerate}
\end{remark}

\begin{proof}
  Any open subscheme of an affine scheme is covered by basic opens, so it is reduced.
  For any cover $(U_i)_i$ of $X$ and a given reduced cover $(V_j)_j$, we have $U_i=\bigcup_j V_j\cap U_i$, so $U_i$ is reduced.
\end{proof}

\begin{example}
  $V(X^2)\subseteq \bP^2$ is not reduced.
\end{example}


\subsection{Reduced types}

This is joint work of Hugo Moeneclaey and Felix Cherubini.

For any type $X$, we write $\overline{X}$ for the formally étale replacement of $X$.

\begin{definition}
A type $X$ is reduced if for all $P:X\to \Prop$ we have that:
\[(\forall(x:X).\ \overline{P(x)}) \to \overline{\forall(x:X).\ P(x)}\]
\end{definition}

\begin{lemma}\label{reduced-colimit}
Reduced types are closed under finite colimits.
\end{lemma}

\begin{proof}
Because the formally étale replacement commutes with finite limits.
\end{proof}

\begin{lemma}\label{reduced-sigma}
Reduced types are closed under $\Sigma$-types.
\end{lemma}

\begin{proof}
Given $X$ reduced and $(Y_x)_{x:X}$ a family of reduced type, we have that:
\[\forall (z:(x:X)\times Y_x).\ \overline{P(z)} \]
\[= \forall (x:X)(y:Y_x).\ \overline{P(x,y)} \]
\[\to \forall (x:X).\ \overline{\forall (y:Y_x).\ P(x,y)} \]
\[\to \overline{\forall (x:X)(y:Y_x).\ P(x,y)} \]
\[= \overline{\forall (z:(x:X)\times Y_x).\ P(z)}\]
\end{proof}

\begin{lemma}\label{reduced-surjection}
If we have a surjection $f:X\to Y$ and $X$ is reduced, then $Y$ is reduced.
\end{lemma}

\begin{proof}
Assume given $P:Y\to\Prop$. We have that:
\[\forall(y:Y).\ \overline{P(y)}\]
\[= \forall(x:X).\ \overline{P(f(x))}\]
\[\to \overline{\forall(x:X).\ P(f(x))}\]
\[= \overline{\forall(y:Y).\ P(y)}\]
\end{proof}

\begin{lemma}\label{reduced-connected}
Any homotopically connected type is reduced.
\end{lemma}

\begin{proof}
Let $X$ be homotopically connected. Since we want to prove a proposition, we can assume $x:X$. Then we have a surjection:
\[x:1\to X\]
and $1$ is reduced so we conclude by \cref{reduced-surjection}.
\end{proof}

\begin{lemma}
A type $X$ is reduced if and only if $\propTrunc{X}_0$ is reduced.
\end{lemma}

\begin{proof}
If $X$ is reduced, so is $\propTrunc{X}_0$ by \cref{reduced-surjection}. Conversly if $\propTrunc{X}_0$ is reduced, we have that:
\[X = \sum_{x:\propTrunc{X}_0} \sum_{y:X} [y] = x\]
but $\sum_{y:X} [y] = x$ is connected, therefore it is reduced by \cref{reduced-connected}, so by \cref{reduced-sigma} we have that $X$ is reduced.
\end{proof}

\begin{remark}
The stability results for being formally smooth and being reduced are very similar.
\end{remark}

\subsection{Reduced affine schemes}

\begin{lemma}\label{reduced-basic-open}
Assume $A$ an f.p. algebra such that for all $a:A$ nilpotent we have that $\overline{a=0}$. Then for any $f:A$ and $b:A_f$ nilpotent, we have that $\overline{b=0}$.
\end{lemma}

\begin{proof}
We have that $b=\frac{c}{f^k}$ and there exists $n:\N$ such that $b^n=0$ in $A_f$, therefore there exists $k:\N$ such that $f^kc^n = 0$ in $A$. From this we know that $fc$ is nilpotent in $A$, therefore $\overline{fc=0}$ and this implies $\overline{b=0}$ as $fc=0$ implies $b=0$.
\end{proof}

\begin{lemma}\label{reduced-zariski-cover}
Assume $A$ an f.p. algebra such that for all $a:A$ is nilpotent we have that $\overline{a=0}$. Then for any Zariski cover:
\[\Spec(B)\to \Spec(A)\]
by basic opens and any closed dense $Q\subset \Spec(B)$ we have $\overline{\forall (y:\Spec(B)).\ Q(y)}$.
\end{lemma}

\begin{proof}
It is enough to prove the property when $B=A_f$ for $f:A$. Given a closed dense $Q\subset \Spec(A_f)$ we know that $Q$ is of the form $V(b_1,\cdots,b_n)$ for $b_1,\cdots,b_n$ nilpotent in $A_f$. Then by \cref{reduced-basic-open} we have that $\overline{b_i = 0}$ for all $i$, therefore:
\[\overline{b_1=0\land\cdots\land b_n=0}\] 
which means $\overline{Q=\Spec(A_f)}$.
\end{proof}

\begin{lemma}\label{ii-implies-i}
Assume $A$ an f.p. algebra such that for all $a:A$, if $a$ is nilpotent then $\overline{a=0}$. Then $\Spec(A)$ is reduced.
\end{lemma}

\begin{proof}
Assume:
\[P:\Spec(A)\to \Prop\]
such that:
\[\forall(x:\Spec(A)).\ \overline{P(x)}\]
This means that:
\[\forall(x:\Spec(A)).\exists (Q:\mathrm{closed\ dense}).\ Q \to P(x) \]
By Zariski local choice we get a Zariski cover by basic opens:
\[f:\Spec(B) \to \Spec(A)\]
and a family of closed dense propositions $Q:\Spec(B) \to \Prop$ such that:
\[\forall (y:\Spec(B)).\ Q(y) \to P(f(y))\]
By \cref{reduced-zariski-cover} we have that:
\[\overline{\forall (y:\Spec(B)).\ Q(y)}\]
so we have that:
\[\overline{\forall (y:\Spec(B)).\ P(f(y))}\]
which is equivalent to:
\[\overline{\forall (x:\Spec(A)).\ P(x)}\]
by the surjectivity of $f$.
\end{proof}

Next lemma is just generic business with modalities, and should probably be moved elsewhere.

\begin{lemma}\label{surjectivity-for-formally-etale}
Assume given $Y$ formally étale and $f:X\to Y$ formally étale-surjective, meaning that for all $y:Y$ we have:
\[\overline{\propTrunc{\fib_f(y)}}\]
Then the induced map:
\[f' : \overline{X}\to Y\]
is surjective.
\end{lemma}

\begin{proof}
Assume $y:Y$, we want to prove:
\[\exists(x:\overline{X}).\ f'(x) =_Y y\]
but this type is a formally étale proposition as it is the truncation of a formally étale type.

Therefore when proving it we can assume $x:\fib_f(y)$ as by hypothesis $\overline{\propTrunc{\fib_f(y)}}$, and $[x]$ gives a witness.
\end{proof}

Next proposition could be called the reduced duality.

\begin{proposition}\label{duality-reduced-algebras}
Let $A$ be an f.p. algebra such that $\Spec(A)$ is reduced. Then the map:
\[\overline{A} \to \overline{R}^{\Spec(A)}\]
is an equivalence.
\end{proposition}

\begin{proof}
First we prove that the map is injective, and then surjective.
\begin{itemize}

\item In order to prove injectivity, it is enough to prove that for all $a:A$ such that:
\[\forall (x:\Spec(A)).\ [a(x)] =_{\overline{R}} [0]\]
we have that:
\[[a] =_{\overline{A}} [0]\]
But this just means that:
\[\forall (x:\Spec(A)).\ \overline{a(x)=0}\]
implies that:
\[\overline{a=0}\]
which is a clear consequence of $\Spec(A)$ being reduced.

\item For surjectivity, by \cref{surjectivity-for-formally-etale} it is enough to prove that the map:
\[A\to \overline{R}^{\Spec(A)}\]
is formally-étale surjective. So it means than given a map $f: \Spec(A)\to \overline{R}$ we need to merely find a dotted lift in:
 \begin{center}
      \begin{tikzcd}
        & R\ar[d] \\
       \Spec(A) \ar[r]\ar[ru,dashed] & \overline{R}
      \end{tikzcd}
    \end{center}
up to formally étale replacement. By Zariski local choice we get local lifts $g_i$ on a cover of by basic opens $(U_i)_{i:I}$. Consider $i,j:I$, then for all $x:U_i\cap U_j$ we have that $[g_i(x)] =_{\overline{R}} [g_j(x)]$ which means that $g_i-g_j$ is nilpotent in $U_i\cap U_j$. So by \cref{reduced-basic-open} we have that:
\[\overline{g_i = g_j}\]
when restricted to the basic open $U_i\cap U_j$. But there is finitely many such $i,j$, so when building the lift up to formally étale replacement we can assume $g_i = g_j$ for all $i,j$ and get a global lift.
\end{itemize}
\end{proof}

\begin{remark}
For $A$ f.p. we have that:
\[\overline{\Spec(A)} = \Hom_{R}(A,\overline{R}) = \Hom_{\overline{R}}(\overline{A},\overline{R})\]
where the first step relies crucially on $A$ being f.p. and formally étale being lex, and the second step working for any lex modality. (NOT CHECKED IN DETAILS)
\end{remark}

\begin{theorem}\label{reduced-affine}
Let $A$ be an f.p. algebra. The following are equivalent:
\begin{enumerate}[(i)]
\item $\Spec(A)$ is reduced.
\item For all $a:A$ nilpotent, we have that $\overline{a=0}$.
\item\label{reduced-affine-iii} For all $a:A$ nilpotent, there are $r_1,\cdots,r_n:R$ nilpotent and $a_1,\cdots,a_n:A$ such that:
\[a = r_1a_1+\cdots+r_na_n\]
\item The map:
\[\overline{A}\to \overline{R}^{\Spec(A)}\]
is an equivalence.
\end{enumerate}
\end{theorem}

\begin{proof}
It goes as follow:
\begin{itemize}
\item (iii) implies (ii). When proving:
\[\overline{r_1a_1+\cdots+r_na_n = 0}\]
we can assume $r_i=0$ for all $i$, as they are nilpotent.
\item (ii) implies (iii). Assume $a:A$ such that $\overline{a=0}$, then there is an f.g. nilpotent ideal $I$ in $R$ such that:
\[I=0 \to a=0\]
then the image of $a$ under:
\[A\to A^{I=0}\]
is $0$, and since $A$ is strongly quasi-coherent we have that:
\[A^{I=0} = A\otimes R/I = A/IA\]
so $a\in IA$ and we can conclude.
\item (ii) implies (i). By \cref{ii-implies-i}.
\item (i) implies (iv). By \cref{duality-reduced-algebras}.
\item (iv) implies (ii). Assume $a:A$ nilpotent, then for all $x:\Spec(A)$ we have $a(x)$ nilpotent so that:
\[ [a(x)] =_{\overline{R}} [0]\]
So the map:
\[A \to \overline{R}^{\Spec(A)}\] 
sends $a$ to $0$. By the assumed duality, we have that:
\[ [a] =_{\overline{A}} [0]\]
which precisely means:
\[\overline{a=0}\]
as being formally étale is a lex modality.
\end{itemize}
\end{proof}

\begin{remark}
We did not manage to prove that it is not equivalent to \cref{candidate-reduced}. Is it?
\end{remark}

The following theorem is joint work with Thierry Coquand.

\begin{theorem}
  \label{reduced-algebra-as-functions}
  For any f.p.\ $R$-algebra $A$, the induced map
  \[
    A/\Nil(A)\to \overline{R}^{\Spec(A)}
    \]
    is an equivalence.
\end{theorem}

\begin{proof}\rednote{TODO: Check and add details.}
  Using local choice and boundedness, we have that $\Nil(A)\to \Nil(R)^{\Spec(A)}$ is an equivalence.
  So the induced map $A\to \overline{R}^{\Spec(A)}$ factors to $A/\Nil(A)\to \overline{R}^{\Spec(A)}$ and we can conclude by showing that the induced map $R^{\Spec(A)}\to \overline{R}^{\Spec(A)}$ is surjective.

  So we need to lift:
  \begin{center}
    \begin{tikzcd}
      & R\ar[d,->>] \\
      \Spec(A)\ar[r]\ar[ru,dotted,"\exists?"] & \overline{R}
    \end{tikzcd}
  \end{center}
  The kernel of the right map is $\Nil(R)$, so we can conclude by showing that $\Nil(R)$
  is wqc, since that implies $H^1(\Spec(A),\Nil(R))=0$.
  Let $r:R$. By the first argument above, we have an equivalence $\Nil(R_r)\to \Nil(R)^{\Spec(R_r)}$.
  So we show that
  \[\varphi:\Nil(R)_r\to \Nil(R_r)\]
  is an equivalence.
  
  Let $\frac{a}{r^l}:R_r$ be nilpotent. Then $ra$ is nilpotent in $R$.
  So $\frac{ra}{r^{l+1}}:\Nil(R)_r$ and we have $\varphi(\frac{ra}{r^{l+1}})=\frac{a}{r^l}$.
  Now let $\varphi(\frac{a}{r^l})$ be zero in $\Nil(R_r)$.
  Then $r^na=0$ in $R$, so $\frac{a}{r^l}$ is zero in $\Nil(R)_r$.
\end{proof}

\begin{corollary}
  By \Cref{reduced-algebra-as-functions} and \Cref{reduced-affine}, we have a map
  \[
     \overline{A}\to A/\Nil(A)
     \]
     which is an equivalence if and only if $\Spec(A)$ is reduced.
     As this map factors the canonical $A\to A/\Nil(A)$, we have that
     $\Spec(A)$ is reduced, if and only if $\overline{a=0}$ and $a$ nilpotent are equivalent for all $a:A$.\rednote{Is this something we really didn't know already?}.
\end{corollary}

\subsection{Examples}

For affine schemes we always use criteria (ii) from \cref{reduced-affine}.

\begin{lemma}
For all $n:\N$, we have that $R^n$ is reduced.
\end{lemma}

\begin{proof}
If $P:R[X_1,\cdots,X_n]$ is nilpotent then all its coefficients are nilpotent, therefore when proving $\overline{P=0}$ we can assume all the coefficients of $P$ are $0$.
\end{proof}

\begin{lemma}
Open propositions are reduced.
\end{lemma}

\begin{proof}
By \cref{reduced-basic-open} this holds for basic open proposition. We conclude by \cref{reduced-colimit} and \cref{reduced-surjection}.
\end{proof}

\begin{corollary}
If $(U_i)_{i:I}$ is a Zariski cover of $X$, then $X$ is reduced if and only if $U_i$ is reduced for all $i:I$.
\end{corollary}

\begin{lemma}
Closed dense propositions are reduced.
\end{lemma}

\begin{proof}
Assume $I$ nilpotent f.g. ideal in $R$, and $s:R/I$ such that $s^n = 0$ in $R/I$. There we can get an $r:R$ such that $[r]=s$ in $R/I$ and $r^n \in I$. Then $r$ is nilpotent, so $\overline{r=0}$ and this implies $\overline{s=0}$.
\end{proof}

\begin{lemma}
  The affine scheme $\Spec(R[X,Y]/(XY))$ is reduced.
\end{lemma}

\begin{proof}
  We have $A\colonequiv R\cdot 1\oplus XR[X] \oplus YR[Y]=R[X,Y]/(XY)$ as $R$-modules,
  where the multiplication in $A$ is given by multiplication of polynomials,
  forgetting all coefficients of mixed monomials.
  For a general nilpotent $\alpha+P+Q$ in $A$ with $\alpha: R$, $P:XR[X]$ and $Q:YR[Y]$:
  \[
  0=(\alpha+P+Q)^n=\sum_{k=0}^n {n \choose n-k} \alpha^{n-k} (P^k+Q^k)
  \]
  means that $\alpha$ is nilpotent.
  But then all terms in the sum to the right are nilpotent, except $(P^n+Q^n)$.
  But then $(P^n+Q^n)$ is nilpotent as well, which means that $P$ and $Q$ are nilpotent polynomials.
  So we can conclude with \Cref{reduced-affine} \ref{reduced-affine-iii} .
\end{proof}

We expect that standard étale scheme are reduced. We have not proven it yet, but we have the following:

\begin{remark}
If standard étale schemes are reduced, then any smooth scheme is reduced.
\end{remark}

