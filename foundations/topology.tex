
\subsection{Closed subtypes}

\begin{definition}%
  \label{closed-proposition}\label{closed-subtype}
  \begin{enumerate}[(a)]
  \item
    A \notion{closed proposition} is a proposition
    which is merely of the form $x_1 = 0 \land \dots \land x_n = 0$
    for some elements $x_1, \dots, x_n \in R$.
  \item
    Let $X$ be a type.
    A subtype $U : X \to \Prop$ is \notion{closed}
    if for all $x : X$, the proposition $U(x)$ is closed.
  \item
    For $A$ a finitely presented $R$-algebra
    and $f_1, \dots, f_n : A$,
    we set
    $V(f_1, \dots, f_n) \colonequiv
    \{\, x : \Spec A \mid f_1(x) = \dots = f_n(x) = 0 \,\}$.
  \end{enumerate}
\end{definition}

Note that $V(f_1, \dots, f_n) \subseteq \Spec A$ is a closed subtype
and we have $V(f_1, \dots, f_n) = \Spec (A/(f_1, \dots, f_n))$.

\begin{proposition}[using \axiomref{sqc}]%
  There is an order-reversing isomorphism of partial orders
  \begin{align*}
    \text{f.g.-ideals}(R) &\xrightarrow{{\sim}} \Omega_{cl} \\
    I &\mapsto (I = (0))
  \end{align*}
  between the partial order of finitely generated ideals of $R$
  and the partial order of closed propositions.
\end{proposition}

\begin{proof}
  For a finitely generated ideal $I = (x_1, \dots, x_n)$,
  the proposition $I = (0)$ is indeed a closed proposition,
  since it is equivalent to $x_1 = 0 \land \dots \land x_n = 0$.
  It is also evident that we get all closed propositions in this way.
  What remains to show is that
  \[ I = (0) \Rightarrow J = (0)
     \qquad\text{iff}\qquad
     J \subseteq I
     \rlap{\text{.}}
  \]
  For this we use synthetic quasicoherence.
  Note that the set $\Spec R/I = \Hom_{\Alg{R}}(R/I, R)$ is a proposition
  (has at most one element),
  namely it is equivalent to the proposition $I = (0)$.
  Similarly, $\Hom_{\Alg{R}}(R/J, R/I)$ is a proposition
  and equivalent to $J \subseteq I$.
  But then our claim is just the equation
  \[ \Hom(\Spec R/I, \Spec R/J) = \Hom_{\Alg{R}}(R/J, R/I) \]
  which holds by \Cref{spec-embedding},
  since $R/I$ and $R/J$ are finitely presented $R$-algebras
  if $I$ and $J$ are finitely generated ideals.
\end{proof}

\begin{lemma}[using \axiomref{sqc}]%
  \label{ideals-embed-into-closed-subsets}
  We have $V(f_1, \dots, f_n) \subseteq V(g_1, \dots, g_m)$
  as subsets of $\Spec A$
  if and only if
  $(g_1, \dots, g_m) \subseteq (f_1, \dots, f_n)$
  as ideals of $A$.
\end{lemma}

\begin{proof}
  The inclusion $V(f_1, \dots, f_n) \subseteq V(g_1, \dots, g_m)$
  means we have a map $\Spec (A/(f_1, \dots, f_n)) \to \Spec (A/(g_1, \dots, g_m))$
  over $\Spec A$.
  By \Cref{spec-embedding}, this is equivalent to
  having a homomorphism $A/(g_1, \dots, g_m) \to A/(f_1, \dots, f_n)$,
  which in turn means the stated inclusion of ideals.
\end{proof}

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{closed-subtype-affine}
  A closed subtype $C$ of an affine scheme $X=\Spec A$ is an affine scheme
  with $C=\Spec (A/I)$ for a finitely generated ideal $I\subseteq A$.
\end{lemma}

\begin{proof}
  By \axiomref{Z-choice} and boundedness,
  there is a cover $D(f_1),\dots,D(f_l)$, such that
  on each $D(f_i)$, $C$ is the vanishing set of functions
  \[ g_1,\dots,g_n:D(f_i)\to R\rlap{.} \]
  By \Cref{ideals-embed-into-closed-subsets},
  the ideals generated by these functions
  agree in $A_{f_i f_j}$,
  so by \Cref{fg-ideal-local-global},
  there is a finitely generated ideal $I\subseteq A$,
  such that $A_{f_i}\cdot I$ is $(g_1,\dots,g_n)$
  and $C=\Spec A/I$.
\end{proof}

\subsection{Open subtypes}

While we usually drop the prefix ``qc'' in the definition below,
one should keep in mind, that we only use a definition of quasi compact open subsets.
The difference to general opens does not play a role so far,
since we also only consider quasi compact schemes later.

\begin{definition}%
  \label{qc-open}
  \begin{enumerate}[(a)]
  \item A proposition $P$ is \notion{(qc-)open}, if there merely are $f_1,\dots,f_n:R$,
    such that $P$ is equivalent to one of the $f_i$ being invertible.
  \item Let $X$ be a type.
    A subtype $U:X\to\Prop$ is \notion{(qc-)open}, if $U(x)$ is an open proposition for all $x:X$.
  \end{enumerate}
\end{definition}

\begin{proposition}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{open-iff-negation-of-closed}
  A proposition $P$ is open
  if and only if
  it is the negation of some closed proposition
  (\Cref{closed-proposition}).
\end{proposition}

\begin{proof}
  Indeed, by \Cref{generalized-field-property},
  the proposition $\inv(f_1) \lor \dots \lor \inv(f_n)$
  is the negation of ${f_1 = 0} \land \dots \land {f_n = 0}$.
\end{proof}

\begin{proposition}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{open-union-intersection}
  Let $X$ be a type.
  \begin{enumerate}[(a)]
  \item The empty subtype is open in $X$.
  \item $X$ is open in $X$.
  \item Finite intersections of open subtypes of $X$ are open subtypes of $X$.
  \item Finite unions of open subtypes of $X$ are open subtypes of $X$.
  \item Open subtypes are invariant under pointwise double-negation.
  \end{enumerate}
  Axioms are only needed for the last statement.
\end{proposition}

In \Cref{open-subscheme} we will see that open subtypes of open subtypes of a scheme are open in that scheme.
Which is equivalent to open propositions being closed under dependent sums.

\begin{proof}[of \Cref{open-union-intersection}]
  For unions, we can just append lists.
  For intersections, we note that invertibility of a product
  is equivalent to invertibility of both factors.
  Double-negation stability
  follows from \Cref{open-iff-negation-of-closed}.
\end{proof}

\begin{lemma}%
  \label{preimage-open}
  Let $f:X\to Y$ and $U:Y\to\Prop$ open,
  then the \notion{preimage} $U\circ f:X\to\Prop$ is open.
\end{lemma}

\begin{proof}
  If $U(y)$ is an open proposition for all $y : Y$,
  then $U(f(x))$ is an open proposition for all $x : X$.
\end{proof}

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{open-inequality-subtype}
  Let $X$ be affine and $x:X$, then the proposition
  \[ x\neq y \]
  is open for all $y:X$.
\end{lemma}

\begin{proof}
  We show a proposition, so we can assume $\iota: X\to \A^n$ is a subtype.
  Then for $x,y:X$, $x\neq y$ is equivalent to $\iota(x)\neq\iota(y)$.
  But for $x,y:\A^n$, $x\neq y$ is the open proposition that $x-y\neq 0$.
\end{proof}

The intersection of all open neighborhoods of a point in an affine scheme,
is the formal neighborhood of the point.
We will see in \Cref{intersection-of-all-opens}, that this also holds for schemes.

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{affine-intersection-of-all-opens}
  Let $X$ be affine and $x:X$, then the proposition
  \[ \prod_{U:X\to \Open}U(x)\to U(y) \]
  is equivalent to $\neg\neg (x=y)$.
\end{lemma}

\begin{proof}
  By \Cref{open-union-intersection}, $\neg\neg (x=y)$ implies $\prod_{U:X\to \Open}U(x)\to U(y)$.
  For the other implication,
  $\neg (x=y)$ is open by \Cref{open-inequality-subtype}, so we get a contradiction.
\end{proof}

We now show that our two definitions (\Cref{affine-open}, \Cref{qc-open})
of open subtypes of an affine scheme are equivalent.

\begin{theorem}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-affine-open}
  Let $X=\Spec A$ and $U:X\to\Prop$ be an open subtype,
  then $U$ is affine open, i.e. there merely are $h_1,\dots,h_n:X\to R$ such that
  $U=D(h_1,\dots,h_n)$.
\end{theorem}

\begin{proof}
  Let $L(x)$ be the type of finite lists of elements of $R$,
  such that one of them being invertible is equivalent to $U(x)$.
  By assumption, we know
  \[\prod_{x:X}\propTrunc{L(x)}\rlap{.}\]
  So by \axiomref{Z-choice}, we have $s_i:\prod_{x:D(f_i)}L(x)$.
  We compose with the length function for lists to get functions $l_i:D(f_i)\to\N$.
  By \Cref{boundedness}, the $l_i$ are bounded.
  Since we are proving a proposition, we can assume we have actual bounds $b_i:\N$.
  So we get functions $\tilde{s_i}:D(f_i)\to R^{b_i}$,
  by append zeros to lists which are too short,
  i.e. $\widetilde{s}_i(x)$ is $s_i(x)$ with $b_i-l_i(x)$ zeros appended.

  Then one of the entries of $\widetilde{s}_i(x)$ being invertible,
  is still equivalent to $U(x)$.
  So if we define $g_{ij}(x)\colonequiv \pi_j(\widetilde{s}_i(x))$,
  we have functions on $D(f_i)$, such that
  \[
    D(g_{i1},\dots,g_{ib_i})=U\cap D(f_i)
    \rlap{.}
  \]
  By \Cref{affine-open-trans}, this is enough to solve the problem on all of $X$.
\end{proof}

This allows us to transfer one important lemma from affine-opens to qc-opens.
The subtlety of the following is that while it is clear that the intersection of two
qc-opens on a type, which are \emph{globally} defined is open again, it is not clear,
that the same holds, if one qc-open is only defined on the other.

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-trans}
  Let $X$ be a scheme, $U\subseteq X$ qc-open in $X$ and $V\subseteq U$ qc-open in $U$,
  then $V$ is qc-open in $X$.
\end{lemma}

\begin{proof}
  Let $X_i=\Spec A_i$ be a finite affine cover of $X$.
  It is enough to show, that the restriction $V_i$ of $V$ to $X_i$ is qc-open.
  $U_i\colonequiv X_i\cap U$ is qc-open in $X_i$, since $X_i$ is qc-open.
  By \Cref{qc-open-affine-open}, $U_i$ is affine-open in $X_i$,
  so $U_i=D(f_1,\dots,f_n)$.
  $V_i\cap D(f_j)$ is affine-open in $D(f_j)$, so by \Cref{affine-open-trans},
  $V_i\cap D(f_j)$ is affine-open in $X_i$.
  This implies $V_i\cap D(f_j)$ is qc-open in $X_i$ and so is $V_i=\bigcup_{j}V_i\cap D(f_j)$.
\end{proof}

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{qc-open-sigma-closed}
  \begin{enumerate}[(a)]
  \item qc-open propositions are closed under dependent sums:
    if $P : \Open$ and $U : P \to \Open$,
    then the proposition $\sum_{x : P} U(x)$ is also open.
  \item Let $X$ be a type. Any open subtype of an open subtype of $X$ is an open subtype of $X$.
  \end{enumerate}
\end{lemma}

\begin{proof}
  \begin{enumerate}[(a)]
  \item Apply \Cref{qc-open-trans} to the point $\Spec R$.
  \item Apply the above pointwise.
  \end{enumerate}
\end{proof}

\begin{remark}
  \Cref{qc-open-sigma-closed} means that
  the (qc-) open propositions constitute a \notion{dominance}
  in the sense of~\cite{rosolini-phd-thesis}.
\end{remark}

The following fact about the interaction of closed and open propositions
is due to David WÃ¤rn.

\begin{lemma}%
  \label{implication-from-closed-to-open}
  Let $P$ and $Q$ be propositions
  with $P$ closed and $Q$ open.
  Then $P \to Q$ is equivalent to $\lnot P \lor Q$.
\end{lemma}

\begin{proof}
  For any propositions $P$, $Q$, it is the case that $\lnot P \lor Q$ implies $P \to Q$ and that $P \to Q$ implies $\lnot \lnot (\lnot P \lor Q)$.
  When $P$ is closed and $Q$ is open, we have that $\lnot P$ is open by \Cref{open-iff-negation-of-closed}, so $\lnot P \lor Q$ is also an open proposition and thus double-negation stable by \Cref{open-union-intersection}.
\end{proof}

