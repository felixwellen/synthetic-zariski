\subsection{Affine-open subtypes}

We only talk about affine schemes of finite type, i.e. schemes of the form $\Spec A$ (\Cref{spec}),
where $A$ is a finitely presented algebra.

\begin{definition}%
  A type $X$ is \notion{(qc-)affine},
  if there is a finitely presented $R$-algebra $A$, such that $X=\Spec A$.
\end{definition}

If $X$ is affine, it is possible to reconstruct the algebra directly.

\begin{lemma}[using \axiomref{sqc}]%
  \label{algebra-from-affine-scheme}
  Let $X$ be an affine scheme, then there is a natural equivalence $X=\Spec (R^X)$.
\end{lemma}

\begin{proof}
  The natural map $X\to \Spec (R^X)$ is given by mapping $x:X$ to the
  evaluation homomorphism at $x$. 
  There merely is an $A$ such that $X=\Spec A$.
  Applying $\Spec$ to the canonical map $A\to R^{\Spec A}$,
  yields an equivalence by \axiomref{sqc}.
  This is a (one sided) inverse to the map above.
  So we have $X=\Spec (R^X)$.
\end{proof}

\begin{proposition}%
  Let $X$ be a type.
  The type of all finitely presented $R$-algebras $A$, such that $X=\Spec A$, is a proposition.
\end{proposition}

When we write ``$\Spec A$'' we implicitly assume $A$ is a finitely presented $R$-algebra.
Recall from \Cref{standard-open-subset}
that the standard open subset $D(f) \subseteq \Spec A$
is given by $D(f)(x)\colonequiv \inv(f(x))$.

\begin{example}[using \axiomref{loc}, \axiomref{sqc}]
  For $a_1, \dots, a_n : R$, we have
  \[ D((X - a_1) \cdots (X - a_n)) = \A^1 \setminus \{ a_1, \dots, a_n \} \rlap{.}\]
  Indeed,
  for any $x : \A^1$,
  $((X - a_1) \dots (X - a_n))(x)$ is invertible if and only if
  $x - a_i$ is invertible for all $i$.
  But by \Cref{non-zero-invertible}
  this means $x \neq a_i$ for all $i$.
\end{example}

\begin{definition}%
  \label{affine-open}
  Let $X=\Spec A$.
  A subtype $U:X\to\Prop$ is called \notion{affine-open},
  if one of the following logically equivalent statements holds:
  \begin{enumerate}[(i)]%
  \item $U$ is the union of finitely many affine standard opens.
  \item There are $f_1,\dots,f_n:A$ such that
    \[U(x) \Leftrightarrow \exists_{i} f_i(x)\neq 0 \]
  \end{enumerate}
\end{definition}

By \Cref{open-closed-affine-subsets} we have $D(f_1, \dots, f_n) = D(f_1) \cup \dots \cup D(f_n)$.
Note that in general, affine-open subtypes do not need to be affine
-- this is why we use the dash ``-''.

We will introduce a more general definition of open subtype in \Cref{qc-open}
and show in \Cref{qc-open-affine-open}, that the two notions agree on affine schemes.

\begin{proposition}
  Let $X = \Spec A$ and $f : A$.
  Then $D(f) = \Spec A[f^{-1}]$.
\end{proposition}

\begin{proof}
  \[ D(f) =
     \sum_{x : X} D(f)(x) =
     \sum_{x : \Spec A} \inv(f(x)) =
     \sum_{x : \Hom_{\Alg{R}}(A, R)} \inv(x(f)) =
     \Hom_{\Alg{R}}(A[f^{-1}], R) =
     \Spec A[f^{-1}]
     \]
\end{proof}

Affine-openness is transitive in the following sense:

\begin{lemma}%
  \label{affine-open-trans}
  Let $X=\Spec A$ and $D(f)\subseteq X$ be a standard open.
  Any affine-open subtype $U$ of $D(f)$ is also affine-open in $X$.
\end{lemma}

\begin{proof}
  It is enough to show the statement for $U=D(g)$, $g:A_f$.
  Then
  \[ g=\frac{h}{f^k}\rlap{.}\]
  Now $D(hf)$ is an affine-open in $X$,
  that coincides with $U$: \\
  Let $x:X$, then $(hf)(x)$ is invertible, if and only if both $h(x)$ and $f(x)$ are invertible.
  The latter means $x:D(f)$, so we can interpret $x$ as a homomorphism from $A_f$ to $R$.
  Then $x:D(g)$ means $x(g)$ is invertible, which is equivalent to $x(h)$ being invertible,
  since $x(f)^k$ is invertible anyway.
\end{proof}

\begin{lemma}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{standard-open-empty}
  Let $X=\Spec A$ be an affine scheme and $D(f)\subseteq X$ a standard open,
  then $D(f)=\emptyset$, if and only if, $f$ is nilpotent.
\end{lemma}

\begin{proof}
  Since $D(f)=\Spec A_f$, by \Cref{weak-nullstellensatz}, we know $D(f)=\emptyset$,
  if and only if, $A_f=0$.
  The latter is equivalent to $f$ being nilpotent.
\end{proof}

More generally,
the Zariski-lattice consisting of the radicals
of finitely generated ideals of a finitely presented $R$-algebra $A$,
coincides with the lattice of open subtypes.
This means, that internal to the Zariski-topos,
it is not necessary to consider the full Zariski-lattice for a constructive treatment of schemes.

\begin{lemma}[using \axiomref{sqc}]%
  Let $A$ be a finitely presented $R$-algebra
  and let $f, g_1, \dots, g_n \in A$.
  Then we have $D(f) \subseteq D(g_1, \dots, g_n)$
  as subsets of $\Spec A$
  if and only if $f \in \sqrt{(g_1, \dots, g_n)}$.
\end{lemma}

\begin{proof}
  Since $D(g_1, \dots, g_n) = \{\, x \in \Spec A \mid x \notin V(g_1, \dots, g_n) \,\}$,
  \footnote{See \Cref{open-closed-affine-subsets} for ``$V(\dots)$''}
  the inclusion $D(f) \subseteq D(g_1, \dots, g_n)$
  can also be written as
  $D(f) \cap V(g_1, \dots, g_n) = \varnothing$, that is,
  $\Spec((A/(g_1, \dots, g_n))[f^{-1}]) = \varnothing$.
  By (\axiomref{sqc})
  this means that the finitely presented $R$-algebra $(A/(g_1, \dots, g_n))[f^{-1}]$
  is zero.
  And this is the case if and only if $f$ is nilpotent in $A/(g_1, \dots, g_n)$,
  that is, if $f \in \sqrt{(g_1, \dots, g_n)}$, as stated.
\end{proof}

In particular,
we have $\Spec A = \bigcup_{i = 1}^n D(f_i)$
if and only if $(f_1, \dots, f_n) = (1)$.

\subsection{Pullbacks of affine schemes}

\begin{lemma}%
  \label{affine-product}
  The product of two affine schemes is again an affine scheme,
  namely
  $\Spec A \times \Spec B = \Spec (A \otimes_R B)$.
\end{lemma}

\begin{proof}
  By the universal property of the tensor product $A \otimes_R B$.
\end{proof}

More generally we have:

\begin{lemma}[using \axiomref{sqc}]%
  \label{affine-fiber-product}
  Let $X=\Spec A,Y=\Spec B$ and $Z=\Spec C$ be affine schemes
  with maps $f:X\to Z$, $g:Y\to Z$.
  Then the pullback of this diagram is an affine scheme given by $\Spec (A\otimes_C B)$.
\end{lemma}

\begin{proof}
  The maps $f:X\to Z$, $g:Y\to Z$ are induced by $R$-algebra homomorphisms $f^*:A\to R$ and $g^*:B\to R$.
  Let
  \[ (h,k,p) : \Spec A \times_{\Spec C} \Spec B \]
  with $p:h\circ f^*=k\circ g^* $.
  This defines a $R$-cocone on the diagram
  \[
    \begin{tikzcd}
      A & C\ar[r,"g^*"]\ar[l,"f^*",swap] & B
    \end{tikzcd}
  \]
  Since $A\otimes_C B$ is a pushout in $R$-algebras,
  there is a unique $R$-algebra homomorphism $A\otimes_C B \to R$ corresponding to $(h,k,p)$.
\end{proof}

\subsection{Boundedness of functions to $\N$}

While the axiom \axiomref{sqc}
describes functions on an affine scheme
with values in $R$,
we can generalize it to functions taking values
in another finitely presented $R$-algebra,
as follows.

\begin{lemma}[using \axiomref{sqc}]%
  \label{algebra-valued-functions-on-affine}
  For finitely presented $R$-algebras $A$ and $B$,
  the function
  \begin{align*}
    A \otimes B &\xrightarrow{\sim} (\Spec A \to B) \\
    c &\mapsto (\varphi \mapsto (\varphi \otimes B)(c))
  \end{align*}
  is a bijection.
\end{lemma}

\begin{proof}
  We recall $\Spec (A \otimes B) = \Spec A \times \Spec B$
  from \Cref{affine-product}
  and calculate as follows.
  \begin{alignat*}{8}
    A \otimes B
    &=& (\Spec (A \otimes B) \to R)
    &=& (\Spec A \times \Spec B \to R)
    &=& (\Spec A \to (\Spec B \to R))
    &=& (\Spec A \to B) \\
    c
    &\mapsto& (\chi \mapsto \chi(c))
    &\mapsto& ((\varphi, \psi) \mapsto (\varphi \otimes \psi)(c))
    &\mapsto& (\varphi \mapsto (\psi \mapsto (\varphi \otimes \psi)(c)))
    &\mapsto& (\varphi \mapsto (\varphi \otimes B)(c))
  \end{alignat*}
  The last step is induced by the identification
  $B = (\Spec B \to R),\, b \mapsto (\psi \mapsto \psi(b))$,
  and we use the fact that
  $\psi \circ (\varphi \otimes B) = \varphi \otimes \psi$.
\end{proof}

\begin{lemma}[using \axiomref{sqc}]%
  \label{eventually-vanishing-sequence-on-affine}
  Let $A$ be a finitely presented $R$-algebra
  and let $s : \Spec A \to (\N \to R)$
  be a family of sequences,
  each of which eventually vanishes:
  \[ \prod_{x : \Spec A} \propTrunc{\sum_{N : \N} \prod_{n \geq N} s(x)(n) = 0} \]
  Then there merely exists one number $N : \N$
  such that $s(x)(n) = 0$ for all $x : \Spec A$ and all $n \geq N$.
\end{lemma}

\begin{proof}
  The set of eventually vanishing sequences $\N \to R$
  is in bijection with the set $R[X]$ of polynomials,
  by taking the entries of a sequence as the coefficients of a polynomial.
  So the family of sequences $s$
  is equivalently a family of polynomials $s : \Spec A \to R[X]$.
  Now we apply \Cref{algebra-valued-functions-on-affine} with $B = R[X]$
  to see that such a family corresponds to a polynomial $p : A[X]$.
  Note that for a point $x : \Spec A$,
  the homomorphism
  \[ x \otimes R[X] : A[X] = A \otimes R[X] \to R \otimes R[X] = R[X] \]
  simply applies the homomorphism $x$ to every coefficient of a polynomial,
  so we have $(s(x))_n = x(p_n)$.
  This concludes our argument,
  because the coefficients of $p$,
  just like any polynomial,
  form an eventually vanishing sequence.
\end{proof}

\begin{theorem}[using \axiomref{loc}, \axiomref{sqc}]%
  \label{boundedness}
  Let $A$ be a finitely presented $R$-algebra.
  Then every function $f : \Spec A \to \N$ is bounded:
  \[ \Pi_{f : \Spec A \to \N} \propTrunc{\Sigma_{N : \N} \Pi_{x : \Spec A} f(x) \le N}
     \rlap{.} \]
\end{theorem}

\begin{proof}
  Given a function $f : \Spec A \to \N$,
  we construct the family $s : \Spec A \to (\N \to R)$
  of eventually vanishing sequences
  given by
  \[
    s(x)(n) \colonequiv
    \begin{cases}
      \,1 &\text{if $n < f(x)$}\\
      \,0 &\text{else} \rlap{.}
    \end{cases}
  \]
  Since $0 \neq 1 : R$ by \axiomref{loc},
  we in fact have $s(x)(n) = 0$ if and only if $n \geq f(x)$.
  Then the claim follows from \Cref{eventually-vanishing-sequence-on-affine}.
\end{proof}

If we also assume the axiom \axiomref{Z-choice},
we can formulate the following simultaneous strengthening
of \Cref{eventually-vanishing-sequence-on-affine}
and \Cref{boundedness}.

\begin{proposition}[using \axiomref{loc}, \axiomref{sqc}, \axiomref{Z-choice}]%
  \label{strengthened-boundedness}
  Let $A$ be a finitely presented $R$-algebra.
  Let $P : \Spec A \to (\N \to \Prop)$
  be a family of upwards closed, merely inhabited subsets of $\N$.
  Then the set
  \[ \bigcap_{x : \Spec A} P(x) \subseteq \N \]
  is merely inhabited.
\end{proposition}

\begin{proof}
  By \axiomref{Z-choice},
  there merely exists a cover
  $\Spec A = \bigcup_{i = 1}^n D(f_i)$
  and functions $p_i : D(f_i) \to \N$
  such that $p_i(x) \in P(x)$ for all $x : D(f_i)$.
  By \Cref{boundedness},
  every $p_i : D(f_i) = \Spec A[f_i^{-1}] \to \N$
  is merely bounded by some $N_i : \N$,
  and then $\mathrm{max}(N_1, \dots, N_n) \in P(x)$ for all $x : \Spec A$.
\end{proof}
