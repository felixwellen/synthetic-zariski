\documentclass[10pt,a4paper]{article}

\usepackage{color}
\newcommand\coloremph[2][red]{\textcolor{#1}{\emph{#2}}}

\newcommand\greenemph[2][green]{\textcolor{#1}{\emph{#2}}}
\newcommand{\EMP}[1]{\emph{\textcolor{red}{#1}}}

\usepackage{url}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,mathtools,amsthm,thmtools}
\usepackage{hyperref}
\usepackage[capitalise]{cleveref}
\usepackage{xfrac}
\usepackage{enumitem}
\usepackage{epsf}
\usepackage{epsfig}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newcommand{\ras}{\twoheadrightarrow}

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{\(\scriptscriptstyle\langle\!\langle\,\)}}
\def\feg{\leavevmode\raise
.3ex\hbox{\(\scriptscriptstyle\,\rangle\!\rangle\)}}

%%%%%%%%%

\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}


\newcommand{\nats}{\mathbb{N}}

\newcommand{\Fin}[1]{T(#1)}

\newcommand{\ODisc}{\mathsf{ODisc}}
\newcommand{\ints}{\mathbb{Z}}
\newcommand{\rats}{\mathbb{Q}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\Stone}{\mathsf{Stone}}
\newcommand{\CHaus}{\mathsf{CHaus}}
\newcommand{\Open}{\mathsf{Open}}
\newcommand{\Closed}{\mathsf{Closed}}
\newcommand{\AbG}{\mathsf{Ab}}
\newcommand{\OAbG}{\mathsf{Ab_{ODisc}}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ra}{\rightarrow}
\newcommand{\Noo}{\nats_{\infty}}
\newcommand\norm[1]{\left\lVert #1 \right\rVert}
\newcommand\cHH{\check{H}}%\newcommand\cHH{\check{\mathrm{H}}}
\newcommand{\disc}{\mathsf{disc}}
\newcommand{\Min}{\mathsf{min}}
\newcommand{\Tr}{\mathsf{Tr}}
\newcommand{\Nm}{\mathsf{Nr}}
\newcommand{\Nmr}{\mathsf{Nrd}}
\newcommand{\Hom}{\mathsf{Hom}}
\newcommand{\U}{\mathsf{U}}

\newcommand{\Cat}{\mathsf{Cat}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\cSet}{\mathsf{cSet}}
\newcommand{\Alg}{\mathsf{Alg}}

\DeclareDocumentCommand\HoTT{}{\ensuremath{\mathsf{HoTT}}}

\DeclareMathOperator\op{\mathsf{op}}

\newcommand\inl{\mathsf{inl}}
\newcommand\inr{\mathsf{inr}}

\DeclarePairedDelimiter\truncImpl{\lVert}{\rVert}
\DeclareDocumentCommand\trunc{sm}{\truncImpl{#2}\IfBooleanT{#1}{_{\mathsf{S}}}}

\newcommand\Ty{\mathsf{Ty}}
\newcommand\El{\mathsf{El}}
\newcommand\p{\mathsf{p}}
\newcommand\q{\mathsf{q}}
\DeclareMathOperator\id{id}
\DeclarePairedDelimiter\gen{\langle}{\rangle}
\DeclarePairedDelimiter\paren{(}{)}
\DeclarePairedDelimiter\set{\{}{\}}
\newcommand\R{\mathsf{R}}
\newcommand\Spec{\mathsf{Spec}}
\newcommand\bbI{\mathbb{I}}
\renewcommand\Pr{\mathsf{Pr}}
\newcommand\Term{\mathsf{Term}}
\newcommand\Fib{\mathsf{Fib}}
\newcommand\isContr{\mathsf{isContr}}

\newcommand\bbT{\mathbb{T}}

\DeclareDocumentCommand\Alg{so}{\IfNoValueTF{#2}{\mathsf{Alg}}{#2\textsf{-}\mathsf{Alg}}\IfBooleanT{#1}{_{fp}}}


\usepackage{tikz,tikz-cd}
\tikzcdset{cells={font=\everymath\expandafter{\the\everymath\displaystyle}}}
\tikzset{weq/.style = {"\sim"'{sloped,font=\tiny,#1}}}

\usepackage{todonotes}


\begin{document}

\title{Errata}

\author{Thierry Coquand, Jonas H\"ofer and Christian Sattler}
\date{}
\maketitle

%\rightfooter{}

\section*{Introduction}

We report a mistake (and a way to fix this mistake in important cases) in the construction of a model for the axiom system over \HoTT{} presented in~\cite{draft}.
A construction for the general cases will be presented in upcoming work.

The model construction, as presented in the paper has three parts.
The first step is to construct the key objects, and derive in the duality axiom in the \(1\)-topos \([\Alg*[k], \Set]\).
In a second these objects and axioms are (implicitly) lifted to the higher topos \([\Alg*[k], \cSet]\), and a number of additional axioms are derived.
In the third step, in the internal language of the higher topos, a higher modality is constructed, the modal types of which yield the final model.

The issue is in the second step.
It is possible to lift the objects, and the axioms mentioning them.
The issue is that in a constructive meta-theory these objects are not correct, in the sense that they do not have the expected universal properties.
In a constructive meta theory, it is not provable that the version of the duality axiom shown in the paper is the unfolding of the semantics of the duality axiom as specified in internal language.
The object claimed to be the finitely presented \(\R\)-algebra specified by a given presentation can in general not be shown to have the correct universal property. 

\paragraph{Structure}
\Cref{sec:preliminaries} covers some preliminaries and establishes notation.
In \Cref{sec:cset-homotopy-quotient-vs-meta-quotient}, we prove some precise statements linking homotopy quotients in cubical sets, and quotients in the meta theory.
In \Cref{sec:k-duality-implies-k-alg-choice}, we show that for the category considered in the paper, we can only expect that the duality axiom is provable in \([\Alg*[k], \cSet]\) if finitely presented \(k\)-algebras admit a choice principle.
In \Cref{sec:duality-in-model-of-modal-types}, we show that if we refine the notion of type slightly, the implication from \Cref{sec:k-duality-implies-k-alg-choice} is a characterization.
From that, we conclude that the model construction works in important cases, such as \(\ints\) and finite field extensions of \(\rats\) and \(\mathbb{F}_p\). 
This also yields another obstruction to duality in the case of a general \(k\) when working with \([\Alg*[k], \cSet]\). 


\section{Preliminaries}\label{sec:preliminaries}

We freely make use of the interpretation of extensional type theory in presheaf categories~\cite{hofmann,huber-phd-thesis}.
In particular, we use the notation by~\cite{huber-phd-thesis}.
As in \cite{draft}, we work with cubical sets.
We denote by \(\square\) a cube category that satisfies the axioms from \cite{survey} and is a subcategory of finite non-empty posets.
The category of cubical sets \([\square^{\op}, \Set]\) is denoted by \(\cSet\).

Since we work with strict equality and paths, we denote the latter by \(\simeq\).
We only ever consider propositional truncations.
For \(A \in \Ty_{\cSet}(\Gamma)\) we denote the usual truncation by \(\trunc{A} \in \Ty_{\cSet}(\Gamma)\).
Presheaf models also support in general a \emph{strict} truncation.
For \(A \in \Ty_{[C^{\op}, \Set]}(\Gamma)\) we write \(\trunc*{S} \in \Ty_{[C^{\op}, \Set]}(\Gamma)\) for the strict truncation given by \(\trunc*{S}\gamma \coloneqq \set{ \star \mid \exists x. x \in S\gamma }\).
In the model of \HoTT{}, this is always a fibrant type, and a proposition.


\todo[inline,color=green]{The remaining subsection should maybe be an appendix. We derive some easy consequences of the CRS setup that are not easily citable from the paper.}
\subsection{Cubical Presheaves}

The model on \([\Alg[k], \cSet]\) is a cubical presheaf model.
We recall some results by~\cite{CRS21}, that we need below.
Let \(C\) be a (small) category.
Then, \([C^{op}, \cSet] \cong [C^{\op} \times \square^{\op}, \Set]\) carries a model of homotopy type theory since it satisfies the axiom in from~\cite{survey}.
We refer to this model as the \emph{na{\"\i}ve cubical presheaf}.

The key problem with the na{\"\i}ve cubical presheaf model is that many constructions are not characterized levelwise, as they are in ordinary presheaves.
The properties we consider (e.g. the universal property of the quotient) imply that the analogous property holds levelwise, but the converse is not true in general.
In \Cref{sec:duality-in-model-of-modal-types}, we will need some of these converses, to reduce problems to levelwise problems in cubical sets, and from there to problems in set.

To solve the above,~\cite{CRS21} introduce a lex modality \(D\) on \([C^{\op}, \cSet]\).
The key property of this modality is that contractibility of modal types, and therefore equivalences between them, are characterized levelwise.
We derive some consequences of this key theorem for later use.

\todo[inline,color=yellow]{Formally, all these are maps that are natural in \(\Gamma\) in the expected way. State these as-well?}

\begin{lemma}\label{prop:psh:levelwise-n-type-if-n-type}
  Let \(n \geq -2\), and \(A \in \Ty_{[C^{\op}, \cSet]}(\Gamma)\).
  \begin{enumerate}[label=(\arabic*)]
    \item If \(A\) is an \(n\)-type then \(A_I \in \Ty_{\cSet}(\Gamma_I)\) is an \(n\)-type.
    \item\label{prop:psh:levelwise-n-type-if-n-type:modal-converse} If \(A\) is \(D\)-modal, then the converse of holds.
  \end{enumerate}
\end{lemma}
\begin{proof}
  The case for contractible types follows by the characterization as types with an extension operation as defined by~\cite{CRS21}.
  An extension operation for a type in presheaves, has in particular an extension structure for each \(I \in C\).
  If \(A\) is \(D\)-modal, then \(A \simeq DA\) and \(DA\) is contractible if \(A\) is contractible pointwise~\cite[Proposition~3.6.]{CRS21}.
  For the inductive case, it suffices to observe that by the universal property of \(\Pi\), we have \(\El(\Gamma, \textsf{is-\((n+1)\)-type}(A)) \cong \El(\Gamma.A \times A, \textsf{is-\(n\)-type}(x\simeq y))\).
\end{proof}
%
The claim for an internal natural number follows similarly by induction internally to the model of type theory on \(\cSet\) and the fact that every CwF morphism preserves \(\Pi\) in a lax way, but we do not need it here.

\begin{lemma}\label{prop:psh:levelwise-inhabited-if-inhabited}
  Let \(A \in \Ty_{[C^{\op}, \cSet]}(\Gamma)\).
  % More formally, natural in \((\Gamma, A) \in \int_{[C^{\op}, \cSet]} \Ty\) there is a family of maps
  % \[
  %   \El_{[C^{\op}, \cSet]}(\Gamma, \trunc{A}) \longrightarrow \prod_{I \in C} \El(\Gamma_{I}, \trunc{A_{I}}).
  % \]
  \begin{enumerate}[label=(\arabic*)]
    \item If \(A\) is inhabited, then \(A_I \in \Ty_{\cSet}(\Gamma_I)\) is inhabited for all \(I \in C\).
    \item If \(A\) is \(D\)-modal, then the converse holds.
  \end{enumerate}
\end{lemma}
\begin{proof}
  We construct a proposition \(PA \in \Ty(\Gamma)\) with a map \(A \to PA\).
  We have a canonical inclusion of objects \(i \colon C_0 \hookrightarrow C\).
  Hence, we obtain a CwF-morphism by restriction \(i^* \colon [C^{\op}, \cSet] \to [C^{\op}_0, \cSet]\).
  This CwF-morphism has a right adjoint on types \(i_{*,\Gamma} \colon \Ty_{[C^{\op}_0, \cSet]}(i^*\Gamma) \to \Ty_{[C^{\op}, \cSet]}(\Gamma)\) which is easily seen to preserve fibrant types and propositions.

  The truncation operation in \([C^{\op}, \cSet]\) is given by applying the truncation operation of \(\cSet\) levelwise.
  We define \(PA \coloneqq i_{*,\Gamma}\trunc{i^*A}\).
  Since we have \(\eta_{i^*A} \colon i^* A \to \trunc{i^*A}\) we obtain \(i_{*,\Gamma}\eta \colon i_{*,\Gamma}i^*A \to i_{*,\Gamma}\trunc{i^*A}\) for which precomposition with the unit of the dependent right adjoint yields the desired map \(A \to PA\).
  Concretely, the constructed type is given by
  \[
    (PA)(I, \gamma) = \prod_{f \colon J \to I} \trunc{A(J, \gamma f)}.
  \]
  We show that this type is also \(D\)-modal.
  Since \(D\) is a lex modality, it preserves propositions.
  Hence, it suffices to give map \(D(PA) \to PA\).
  Since \(D\) is a weighted limit of all powers of \(i_{*,\Gamma}i^* \colon [C^{\op}, \cSet] \to [C^{\op}, \cSet]\), we obtain in particular a map \(D(PA) \to i_*i^*(PA)\) from the transformation \(D \to i_*i^*\) of pointed CwF-endomorphisms. % here use that we have morphism of pointed endofunctors between them
  A map \(\alpha \colon i_{*,\Gamma}(i^*(PA)) \to PA\) is given by \((\alpha_{(I, \gamma)}u)_f \coloneqq (u_{f})_{\id}\) which is easily seen to be natural.
  
  Hence, we obtain (for the modal as well as non-modal case) that we have a chain of functions
  \[
    \El_{[C^{\op}, \cSet]}(\Gamma, \trunc{A})
    \longrightarrow \El_{[C^{\op}, \cSet]}(\Gamma, PA)
    \longrightarrow \El_{[C_0^{\op}, \cSet]}(\Gamma, \trunc{i^*A})
    \longrightarrow \prod_{I \in C} \El_{\cSet}(\Gamma_I, \trunc{A_I}),
  \]
  by the universal property of \(\trunc{A}\), the right adjoint on types, and the definition of elements in the model on \([C_0^{\op}, \cSet]\).
  The converse for modal types follows from \Cref{prop:psh:levelwise-n-type-if-n-type}~\ref{prop:psh:levelwise-n-type-if-n-type:modal-converse} since propositions are contractible exactly if they are inhabited.
\end{proof}

A consequence of the above is that surjective functions are levelwise surjective.
This fact is needed for showing that homotopy quotients are levelwise homotopy quotients, the key lemma needed in \Cref{sec:k-duality-implies-k-alg-choice}.

\begin{lemma}\label{prop:psh:levelwise-quotient-if-homotopy-quotient}
  Let \(A \colon \Ty_{[C^{\op}, \cSet]}(\Gamma)\), \(R \colon \Ty_{[C^{\op}, \cSet]}(\Gamma.A.A)\) a homotopy proposition.
  \begin{enumerate}[label=(\arabic*)]
    \item If \(\varrho_R \colon A \to A/R\) is a homotopy quotient of \(A\) by \(R\), then \((\varrho_R)_I \colon A_I \to (A/R)_I\) is a homotopy quotient of \(A_I\) by \(R_I\) for all \(I \in C\).
    \item\label{prop:psh:levelwise-quotient-if-homotopy-quotient:modal-converse} If \(A\) and \(R\) are \(D\)-modal, then the converse holds.
  \end{enumerate}
\end{lemma}
\begin{proof}
  From \cite[Theorem 18.2.3]{rijke2025intro} it follows that \(\varrho_R \colon A \to A/R\) is a homotopy quotient if \(A\) by \(R\) exactly of \(\varrho_R\) is surjective, \(A/R\) is an hset, and for all \(a_0, a_1 \colon A\) we have a logical equivalence \(R(a_0, a_1) \leftrightarrow \paren{\varrho_R(a_0) \simeq \varrho_R(a_1)}\).
  The same characterization applies levelwise.

  Using that \(-_I\) preserves \(\Sigma\) and path types, having a witness that \(\varrho_R\) is a homotopy quotient means we have elements of
  \begin{gather*}  
    \El(\Gamma.(a_0\,a_1 \colon A).R(a_0, a_1), \varrho_R(a_0) \simeq \varrho_R(a_1))
    \qquad \El(\Gamma.(a_0\,a_1 \colon A).(\varrho_R(a_0) \simeq \varrho_R(a_1)), R(a_0, a_1)) \\
    \El(\Gamma, \textsf{is-hset}(A/R))
    \qquad
    \El(\Gamma.(u \colon A/R), \trunc{\Fib_{\varrho_R}}(u)).
  \end{gather*}
  Note that the first three types are propositions.
  By \Cref{prop:psh:levelwise-n-type-if-n-type,prop:psh:levelwise-inhabited-if-inhabited}, these imply the analogous levelwise statements, and for modal types the converse.
\end{proof}
%
To apply these results later, we record the following lemma.

\begin{lemma}\label{prop:levelwise-constant-presheaves-are-modal}
  Levelwise constant types are \(D\)-modal.
\end{lemma}
\begin{proof}
  It suffices to show that \(\eta_A \colon A \to DA\) has a left inverse \(p_A \colon DA \to A\).
  The map \(\eta_A\) is levelwise an equivalence~\cite[Proposition~3.8]{CRS21}.
  This means, internally to \(\cSet\) that for each \(I \in C\) and \(\gamma \colon \Gamma(I)\) we have an inverse \((p_A)_{(I, \gamma)} \colon (DA)\gamma \to A\gamma\) up to homotopy.
  By the usual argument that pointwise inverses of natural transformations are inverses, we obtain that the pointwise inverses are natural up to homotopy:
  \[\begin{tikzcd}
    {A\gamma} && {(DA)\gamma} && {A\gamma} && {(DA)\gamma} \\
    &&& \rightsquigarrow && {\clap{\(H_{(f, \gamma)}\)}} \\
    {A\gamma f} && {(DA)\gamma f} && {A\gamma f} && {(DA)\gamma f\clap{.}}
    \arrow[""{name=0, anchor=center, inner sep=0}, "{(\eta_A)_{(I, \gamma)}}"', shift right=2, from=1-1, to=1-3]
    \arrow[from=1-1, to=3-1]
    \arrow[""{name=1, anchor=center, inner sep=0}, "{(p_A)_{(I, \gamma)}}"', shift right=2, from=1-3, to=1-1]
    \arrow[from=1-3, to=3-3]
    \arrow[from=1-5, to=3-5]
    \arrow["{(p_A)_{(I, \gamma)}}"', from=1-7, to=1-5]
    \arrow[from=1-7, to=3-7]
    \arrow[""{name=2, anchor=center, inner sep=0}, "{(\eta_A)_{(J, \gamma f)}}", shift left=2, from=3-1, to=3-3]
    \arrow[""{name=3, anchor=center, inner sep=0}, "{(p_A)_{(J, \gamma f)}}", shift left=2, from=3-3, to=3-1]
    \arrow["{(p_A)_{(J, \gamma f)}}", from=3-7, to=3-5]
  \end{tikzcd}\]
  This means for each \(f \colon J \to I\) we have for each \(u \colon DA\) a path \(H_{(f, \gamma)} \colon (p_A)_J(uf) \simeq_{A} ((p_A)_Iu)f\).
  Since \(A\) was assumed to be levelwise constant, we have that this path coincides with a strict equality.
  Hence, the levelwise inverses assemble into an inverse.
\end{proof}



\section{Separating homotopy and set-level quotients}\label{sec:cset-homotopy-quotient-vs-meta-quotient}

In this preliminary section we only work with cubical sets, because the key issue already appears in this setting.
Recall that \(\Delta \colon \Set \to \cSet\) is a CwF-homomorphism.

\begin{lemma}\label{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits}
  Let \(S \in \Ty_{\Set}(\Gamma)\) a set, and \(R \in \Ty_{\Set}(\Gamma.S.S)\) a strict proposition.
  \begin{enumerate}[label=(\arabic*)]
    \item\label{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits:well-defined}
      \(\Delta(S/R) \in \Ty_{\cSet}(\Delta\Gamma)\) is an hset with a map \(\Delta\varrho_{R} \colon \Delta S \to \Delta(S/R)\) whose kernel equals \(\Delta R\). 
    \item\label{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits:characterization}
      The type \(\Delta(S/R)\) is a homotopy quotient of \(\Delta S\) by \(\Delta R\) exactly if \(\varrho_{R} \colon S \to S/R\) splits.
    \end{enumerate}  
\end{lemma}
\begin{proof}
  \begin{description}[font=\normalfont,leftmargin=0cm]
  \item[\ref{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits:well-defined}] 
    We have \(S/R \in \Ty(\Gamma)\) given by \((S/R)\gamma = S\gamma / R\gamma\), the quotient of the set \(S\gamma\) by the relation relating \(s_0, s_1 \in S\gamma\) exactly if \(\star \in R(\gamma, s_0, s_1)\).
    This type is equipped with a function \(\varrho_R \colon S \to S/R\) and in the context with \(s_0, s_1 \colon S\) a logical equivalence \(R(s_0, s_1) \leftrightarrow (s_0 =_S s_1)\).

    Applying \(\Delta\), we obtain the desired objects in \(\cSet\).
    Since \(\Delta(S/R)\) is fiberwise constant, we have in the context with \(s_0, s_1 \colon S\) that \((s_0 \simeq s_1) \leftrightarrow (s_0 =_S s_1)\) and thus \((s_0 \simeq s_1) \leftrightarrow \Delta R(s_0, s_1)\).
  \item[\ref{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits:characterization}] % we can reduce to I = [0] if every object in \square admits a map from [0].
    By \cite[Theorem 18.2.3]{rijke2025intro} the map \(\Delta \varrho_{R} \colon \Delta S \to \Delta(S/R)\) is the homotopy quotient of \(\Delta S\) by \(\Delta R\) exactly if \(\Delta(S/R)\) is an hset, \((s_0 \simeq s_1) \leftrightarrow \Delta R(s_0, s_1)\), and \(\Delta \varrho_{R}\) is surjective.
    The first two statements hold by construction.
    If \(\varrho_R\) splits, then so does \(\Delta \varrho_{R} = \Delta \varrho_{R}\), and is therefore surjective.

    Hence, to show the converse assume that \(\Delta \varrho_{R}\) has the universal property of the homotopy quotient.
    We define a type \(Q \in \Ty_{\cSet}(\Delta\Gamma)\) at \((I, \gamma) \in \int\Delta\Gamma\) by
    \[
      Q(I, \gamma) \coloneqq \set{ s \in {(S\gamma)}^{|I|} \mid \text{ \(R\gamma(si_0, si_1)\) if \(i_0 \leq i_1\) } }.
    \]
    This is a fibrant family of types: If \(\gamma \in \Delta\Gamma(I \times [1]) = \Gamma\), \(u_0 \in Q\gamma(I \times 0)\), \(\varphi \in \Phi(I)\), and \(u_f \in Q\gamma(J \times [1])\) for all \(f \colon J \to I\) with \(\varphi f = \top\), obeying the usual coherences.
    We define the family \(\overline u \in Q\gamma \subseteq {(S\gamma)}^{|I \times [1]|}\).
    We are given a family \(u_0 \in Q\gamma(I \times 0) \subseteq {(S\gamma)}^{|I|}\).
    Furthermore, for each \(i \colon [0] \to I\) with \(\varphi i = \top\) we have \(u_i\) corresponding to some element of \(S\gamma\).
    Hence, we set \(\overline u(i, 0) \coloneqq u_0(i)\), \(\overline u(i, 1) \coloneqq u_i\) if \(\varphi i = \top\), and \(\overline u(i, 1) \coloneqq \overline u(i, 0)\) otherwise.

    There is an obvious map \(q \colon \Delta S \to Q\) given at \((I, \gamma) \in \int\Gamma\) by sending \(s \in (\Delta S)(I, \gamma) = S\gamma\) to the constant family.
    Furthermore, there is a map \(R(s_0, s_1) \to (qs_0 \simeq_{Q} qs_1)\).
    At \((I, \gamma) \in \int\Gamma\) for \(s_0, s_1 \in S\gamma\) related by \(R\gamma\), we have to give a family in \(S\gamma\) indexed by \(|I \times [1]|\) which we define by \(s_e\) at \((i, e) \in I \times [1]\).

    Hence, we obtain, by the universal property of the homotopy quotient, a map \(\overline q \colon \Delta(S/R) \to Q\) with a homotopy \(H \colon \overline q \circ \Delta\varrho_R \sim q\).
    Now we construct for each \(\gamma \in \Gamma\) a splitting.
    We have \(\overline{q}_{([0], \gamma)} \colon S/R \to S\) since the points of \(Q\) are given by \(S\).
    Furthermore, for \(s \in S\gamma\) we have a path \(H(\gamma, s) \in Q([1], \gamma\pi_1) \subseteq {(S\gamma)}^{|[1]|}\) with \(H(\gamma, s)(0) = (\overline{q}_{([0], \gamma)} \circ \varrho_R\gamma)(s)\) and \(H(\gamma, s)(1) = s\), i.e., that these two elements are related by \(R\gamma\).
    Hence, \(\overline{q}_{([0], \gamma)}\) is up to \(R\) a retraction of \(\varrho_R\gamma\) implying that \(\varrho_R\gamma\) splits. \qedhere
  \end{description}
\end{proof}

\todo[inline,color=green]{One could expect more general lemmas, comparing coequalizer and homotopy coequalizer. The issue is that since propositions cannot be proven on points, these don't match up as expected. Instead we stay with the claims about ``strict hsets'' and their relations.}

The above lemma only concerns quotients of sets by set-level equivalence relations.
Later we will deal with a more general situation: We consider quotients of fiberwise constant types by relations that are not automatically valued in (strict) propositions.
Instead, we have to truncate them.
Then, the quotient in \(\cSet\) will be the one by the relation truncated to an hprop, while in \(\Set\) the one truncated to a strict proposition.
The following lemma can be summarized as: strict quotients model homotopy quotients by a truncated relations exactly if they have choice and provide witnesses for the relation.

\begin{corollary}\label{prop:set-relevant-quotient-is-homotopy-quotient-iff-surjection-splits-and-witnesses-exist}
  For \(S \in \Ty_{\Set}(\Gamma)\) a type, and \(R \in \Ty_{\Set}(\Gamma.S.S)\) the following are equivalent:
  \begin{enumerate}[label=(\arabic*)]
    \item The type \(\Delta(S/\trunc*{R})\) is a homotopy quotient of \(\Delta S\) by \(\trunc{\Delta R} \in \Ty_{\cSet}(\Delta\Gamma.\Delta S. \Delta S)\).
    \item The map \(S \to S/\trunc*{R}\) in \(\Set\) splits, and there is a map \(\trunc*{R} \to R\).
  \end{enumerate}
\end{corollary}
\begin{proof}
  By \Cref{prop:set-quotient-is-homotopy-quotient-iff-surjection-splits}, the map \(\Delta S \to \Delta(S/\trunc*{R})\) is a homotopy quotient of \(\Delta S\) by \(\Delta\trunc*{R}\) exactly if \(S \to S/\trunc*{R}\) splits.
  Hence, for the claim, it suffices to show that \(\trunc{\Delta R}\) and \(\Delta\trunc*{R}\) coincide exactly if there is a map \(\trunc*{R} \to R\).
  
  First, there always exists a map \(\trunc{\Delta R} \to \Delta\trunc*{R}\) since the latter is also a homotopy proposition with a map from \(R\).
  They are equivalent exactly if there is a map \(\Delta\trunc*{R} \to \trunc{\Delta R}\).
  From the existence property of the truncation (c.f.~\cite[Section~8.3]{draft}), such a map yields a map on points \(\trunc*{R} \to R\).
  Conversely, if we have such a map we can even construct a map \(\Delta\trunc*{R} \to \Delta R\).
\end{proof}
\todo[inline,color=green]{The above is in essence an effectiveness condition. I avoided the name to since it clashes with other uses. In fact, w.r.t. the strict relation, the strict quotient \emph{is} effective.}


\section{A taboo from duality in \texorpdfstring{\([\Alg*[k], \cSet]\)}{[k-Algᶠᵖ, cSet]}}\label{sec:k-duality-implies-k-alg-choice}

% The key issue with the construction from the paper is that objects from presheaf model \([\Alg[k], \Set]\) are lifted to the cubical presheaf model \([\Alg[k], \cSet]\) as constant cubical sets.
We denote by \(\Term_{\Alg[k]}(X_1, \ldots, X_n)\) the set of first-order terms for the theory of \(k\)-algebras that contain additional variables from the finite set \(\set{X_1, \ldots, X_n}\).

\begin{definition}
  We say \emph{f.p.~\(k\)-algebras have choice} if for all \(n, m \in \nats\) and \(p_1, \ldots, p_m \in k[X_1, \ldots, X_n]\) the following canonical surjection splits:
  \[
    \eta_{(p_1, \ldots, p_n)} \colon \Term_{\Alg[k]}(X_1, \ldots, X_n) \longrightarrow \sfrac{k[X_1, \ldots, X_n]}{(p_1, \ldots, p_m)}.
  \]
  We say \emph{f.p.~\(k\)-algebras have witnesses} if for all \(n, m \in \nats\), \(p_1, \ldots, p_m \in k[X_1, \ldots, X_n]\), \(t_1, t_2 \in \Term_{\Alg[k]}(X_1, \ldots, X_n)\) there is a function into the set of derivations that \(t_1, t_2\) are equivalent in the theory of \(k\)-algebras modulo \(p_1 \doteq 0, \ldots, p_m \doteq 0\)
  \[
    \set{\star \mid \eta t_1 = \eta t_2 } \longrightarrow \set{ p_1 \doteq 0, \ldots, p_m \doteq 0 \vdash t_1 \doteq t_2 }. 
  \]
\end{definition}
\begin{remark}\label{rem:choice-and-witness-property-descend}
  If we have a \(k\)-algebra \(M\) presented by \(p_1, \ldots, p_m \in \Term_{\Alg[k]}(X_1, \ldots, X_n)\), then we can choose for each \(m \in M\) a term representation \(t_m \in \Term_{\Alg[k]}(X_1, \ldots, X_n)\) for it.
  We can consider the projection \(\eta \colon \Term_{\Alg[k]}(X_1, \ldots, X_n, Y_1, \ldots, Y_i) \to \Term_{\Alg[M]}(Y_1, \ldots, Y_i)\) that sends \(X_i\) to the corresponding element of \(M\).
  There is a map in the other direction \(\overline\cdot \colon \Term_{\Alg[M]}(Y_1, \ldots, Y_i) \to \Term_{\Alg[k]}(X_1, \ldots, X_n, Y_1, \ldots, Y_i)\) given by replacing all \(m \in M\) in a term by \(t_m\).
  We have that \(p_1 \doteq 0, \ldots, p_m \doteq 0 \vdash \eta(t_m) \doteq m\) and therefore that \(p_1 \doteq 0, \ldots, p_m \doteq 0 \vdash \eta(\overline{t}) \doteq t\) for all \(t \in \Term_{\Alg[M]}(Y_1, \ldots, Y_i)\)
  
  Hence, we can lift \(M\)-algebra presentations to \(k\)-algebra presentations.
  Thus, if \(N\) is an \(M\)-algebra presented by \(q_1, \ldots, q_j \in \Term_{\Alg[M]}(Y_1, \ldots, Y_i)\) we can obtain representatives \(\overline{q_1}, \ldots, \overline{q_j} \in \Term_{\Alg[k]}(X_1, \ldots, X_m, Y_1, \ldots, Y_i)\).
  Then from the composite
  \[
    \Term_{\Alg[k]}(X_1, \ldots, X_n, Y_1, \ldots, Y_i) \longrightarrow \Term_{\Alg[M]}(Y_1, \ldots, Y_i) \longrightarrow \frac{k[x_1, \ldots, X_m, Y_1, \ldots, Y_i]}{(p_1, \ldots, p_n, \overline{q_1}, \ldots, \overline{q_j})} \cong N
  \]
  splitting, we obtain that the second map splits as-well.
  Lastly, let \(t_0, t_1 \in \Term_{\Alg[M]}(Y_1, \ldots, Y_i)\) describing equal elements in \(N\).
  We obtain a derivation that \(\set{p_\ell \doteq 0}_\ell, \set{\overline{q_\ell} \doteq 0}_\ell \vdash \overline{t_0} \doteq \overline{t_1}\).
  Hence, we obtain that \(\set{\eta(p_\ell) \doteq 0}_\ell, \set{\eta(\overline{q_\ell}) \doteq 0}_\ell \vdash \eta(\overline{t_0}) \doteq \eta(\overline{t_1})\) in the theory of \(M\)-algebras.
  Since \(\eta(p_\ell) \doteq 0\), \(\eta(\overline{q_\ell}) = q_\ell\), and \(\eta(\overline{t_i}) \doteq t_i\) are also derivable, we obtain \(\set{q_\ell \doteq t_1}_\ell \vdash t_0 \doteq t_1\).
\end{remark}
\todo[inline,color=yellow]{The above is a by handwavy; In the appendix is a more detailed very direct argument. I am not sure if there is a better argument/whether we should elaborate.}

In a constructive meta-theory it cannot be the case that f.p. \(k\)-algebras have choice for all \(k\).
The following is an adaptation of an argument by Diaconescu~\cite{diaconescu1975choice} to derive a constructive taboo from this statement.

\begin{proposition}
  If for all \(k\) f.p. \(k\)-algebras have choice, then all propositions are decidable.
\end{proposition}
\begin{proof}
  Following the techniques in~\cite{mines}, we can show that for any set \(E\) and any ring \(R\) the canonical map \(E \to R[E]\) is injective.

  Let \(p\) be a proposition and \(P \coloneqq \set{0,1} / \sim_p\).
  We consider the base-ring \(k \coloneqq \mathbb{F}_2[P + P]\).
  By assumption, the map \(\eta \colon \mathbb{F}_2[P + P] \to \mathbb{F}_2[P + P] / (\inl(0) - \inr(0))\) splits.
  Denote the section by \(s : \mathbb{F}_2[P + P] / (\inl(0) - \inr(0)) \to \mathbb{F}_2[P + P]\).

  For \(\inl(1) \in \mathbb{F}_2[P + P]\) we have that \(\eta(\inl(1)) = \eta(s(\eta(\inl(1))))\) since s is a section of \(\eta\).
  Thus, there exists some \(n \in \mathbb{F}_2\) with \(\inl(1) - s(\eta(\inl(1))) = n(\inr(0) - \inr(1))\).
  If \(n = 0\) then we have \(\inl(1) = s(\eta(\inl(1)))\).
  If \(n = 1\) then we have \(\inl(1) + \inr(1) = \inr(0) + s(\eta(\inl(1)))\).
  Since \(\inl(i) \ne \inr(j)\) for all \(i, j\) in \(k\) (by injectivity of \(P + P \hookrightarrow k\) and the same fact in \(P + P\)), we have that \(\inr(1) = \inr(0)\).
  Hence, \(0 = 1\) in \(P\) and therefore \(p\) holds.

  Thus, we have \(p\) or \(\inl(1) = s(\eta(\inl(1)))\).
  Similarly, we can show that \(p\) or \(\inr(1) = s(\eta(\inr(1)))\).
  Our goal is to show \(p\) or not \(p\).
  So suppose we are in the case in which \(\inl(1) = s(\eta(\inl(1)))\) and \(\inr(1) = s(\eta(\inr(1)))\).
  We claim not \(p\), so suppose that we have \(p\) with the goal of a contradiction.
  Since \(p\) holds, we have that
  \[
    \inl(1) = s(\eta(\inl(1))) = s(\eta(\inl(0))) = s(\eta(\inr(0))) = s(\eta(\inr(1))) = \inr(1).
  \]
  This is a contradiction since \(\inl(1) \ne \inr(1)\).
\end{proof}
\todo[inline,color=yellow]{Justify that we can take \(n \in k\) not a polynomial, and that \(a + b = c + d\) implies pairwise equality}

The key issue is that the duality axiom, as claimed in the paper, implies the above.
This means that without changing some basic definitions, we cannot expect to be able to derive the duality axiom in general.

For each f.p. \(k\)-algebra \(M\), and natural number \(n\) we have the set \(\Term_{\Alg[M]}(X_1, \ldots, X_n)\).
This family of sets is easily seen to be functorial in \(M\), and therefore defines a type \(\Term_{\Alg[\R]} \in \Ty_{[\Alg*[k], \Set]}(1.\nats)\) given by \(\Term_{\Alg[\R]}(M, n) \coloneqq \Term_{\Alg[M]}(X_1, \ldots, X_n)\).
This type has internally the universal property of the type of terms over the theory of \(\R\)-algebras in a given finite number of variables.
The type of \(\R\)-algebra presentations is defined as \(\Pr \coloneqq \sum_{n, m \colon \nats} \Term_{\Alg[\R]}(m)^n\). 
The spectrum of an \(\R\)-algebra presentations is defined as \(\Spec(n, m, p) \coloneqq \sum_{ u \colon \R^{m} } \prod_{i \leq n} p_i(u) \simeq 0\).
Lastly, internally, we can define for each presentation \((n, m, p) \colon \Pr\) and \(t_0, t_1 \colon \Term_{\R}\) the type of derivations \(p_1 \doteq 0, \ldots, p_n \doteq 0 \vdash t_0 \doteq t_1\), defining a (strict) equivalence relation on \(\Term_{\R}(m)\) by \(\trunc*{p_1 \doteq 0, \ldots, p_n \doteq 0 \vdash t_0 \doteq t_1}\).

\begin{proposition}\label{prop:duality-for-k-implies-k-choice-and-witnesses}
  If the duality axiom holds in \([\Alg*[k], \cSet]\) then all f.p. \(k\)-algebras have choice and witnesses.
\end{proposition}
\begin{proof}
  By \cite[Section~8.1.2]{draft}, the duality axiom holds in the presheaf model on \([\Alg*[k], \Set]\).
  This means in the context with a presentation \((n, m, p) \colon \Pr\) the following canonical map is an isomorphism:
  \[\begin{tikzcd}
    {\frac{\Term_{\R}(m)}{\trunc*{R_{(n,m,p)}}}} && {\paren[\Bigg]{\paren[\bigg]{\sum_{u \colon \R^m} \prod_{i \leq n} p_i(u) =_{\R} 0} \to \R }.}
    \arrow[from=1-1, to=1-3]
    \arrow[weq, from=1-1, to=1-3]
  \end{tikzcd}\]
  %
  The CwF morphism \(\Delta \colon \Set \to \cSet\) lifts via postcomposition to one \([\Alg*[k], \Set] \to [\Alg*[k], \cSet]\).
  Furthermore, it preserves strict identity, \(\Sigma\), and \(\Pi\) types.
  Hence, applying it to the above, we obtain a strict version of the duality axiom in \([\Alg*[k], \cSet]\).

  We work in \([\Alg*[k], \cSet]\) in the context with a presentation \((n, m, p) \colon \Delta\Pr\).
  We have the following diagram in \([\Alg*[k], \cSet]\).
  \[\begin{tikzcd}
    && {\frac{\Delta\Term_{\R}(m)}{\trunc{\Delta R_{(n,m,p)}}}} && {\paren[\Bigg]{\paren[\bigg]{ \sum_{u \colon (\Delta\R)^m} \prod_{i \leq n} p_i(u) \simeq 0 } \to \R} } \\
    {\Delta\Term_{\R}(m)} \\
    && {\Delta\paren[\bigg]{\frac{\Term_{\R}(m)}{\trunc*{R_{(n,m,p)}}}}} && {\paren[\Bigg]{\paren[\bigg]{\sum_{u \colon (\Delta\R)^m} \prod_{i \leq n} p_i(u) = 0} \to \R} }
    \arrow[from=1-3, to=1-5]
    \arrow[from=1-3, to=3-3]
    \arrow[from=2-1, to=1-3]
    \arrow[from=2-1, to=3-3]
    \arrow[weq, from=3-3, to=3-5]
    \arrow[weq, from=3-5, to=1-5]
  \end{tikzcd}\]
  The definition of the spectrum in \([\Alg*[k], \Set]\) and \([\Alg*[k], \cSet]\) agree, since for each type of the form \(\Delta X\) the diagonal \((\Delta X) \to (\Delta X)^{\bbI}\) is an isomorphism since it is levelwise an isomorphism in \(\cSet\).
  We also lift the type \(R_{(n,m,p)}\) of derivations of equality modulo a presentation, and define the hprop valued relation \(\trunc{R_{(n,m,p)}}\) used in the statement of the duality axiom.
  As before, we have a map \(\sfrac{\Delta\Term_{\R}(m)}{\trunc{\Delta R_{(n,m,p)}}} \to \Delta\paren[\big]{\sfrac{\Term_{\R}(m)}{\trunc*{R_{(n,m,p)}}}}\) making the triangle above commute.
  The square on the right commutes by the universal property of the quotient as-well, since the outer diagram commutes by definition.

  By the \(2\)-out-of-\(3\) property of equivalences, we can conclude that the duality axiom holds exactly if the vertical map on the left is an equivalence.
  This means exactly if \(\Delta\Term_{\R}(m) \to \Delta\paren[\big]{\sfrac{\Term_{\R}(m)}{\trunc*{R_{(n,m,p)}}}}\) has the universal property of the homotopy quotient by w.r.t. the relation \(\trunc{R_{(n,m,p)}}\).
  % The latter also implies by effectiveness of the homotopy quotient that \(\trunc{R_{(n,m,p)}} \leftrightarrow \trunc*{R_{(n,m,p)}}\).

  By \Cref{prop:psh:levelwise-quotient-if-homotopy-quotient}, we have that the evaluation at \(k \in \Alg*[k]\) yields a homotopy quotient in \(\cSet\). 
  Note that \((\Delta \Pr)_k\) is the constant presheaf of finite \(k\)-algebra presentations.
  So in the context with a finite \(k\)-algebra presentation \((n, m, p) \colon (\Delta \Pr)_k\) we have that 
  \[\begin{tikzcd}
    {\frac{\Delta \Term_k(X_1, \ldots, X_n)}{\trunc{\Delta (R_{(n,m,p)})_k}}} && {\Delta\paren[\bigg]{\frac{k[X_1, \ldots, X_m]}{(p_1, \ldots, p_n)}}}
    \arrow[from=1-1, to=1-3]
    \arrow[from=1-1, to=1-3]
  \end{tikzcd}\]
  is a homotopy quotient of \(\Delta \Term_k(X_1, \ldots, X_n)\) by the propositional truncation of a relation valued in strict sets.
  \Cref{prop:set-relevant-quotient-is-homotopy-quotient-iff-surjection-splits-and-witnesses-exist} implies that f.p. \(k\)-algebras have choice and witnesses.
\end{proof}

The above implies that without changing basic definitions we have to at least limit ourselves to those \(k\) for which f.p. \(k\)-algebras have choice and witnesses.
We record here a class of examples which have these properties.
Recall that a field \(k\) is \emph{discrete} if for all \(u \in k\) we have \(u = 0\) or \(u\) that is invertible, which is equivalent to \(k\) having decidable equality~\cite{mines}.
Crucially, it does not include real, or complex numbers.
In this case, we can construct \(k[X_1, \ldots, X_n]\) as linear combinations of monomials with non-zero coefficients, so as a subset of \(\Term_{\Alg[k]}(X_1, \ldots, X_n)\).
Exploiting results from computational algebra, the same holds true for quotients by finitely generated ideals.

\begin{lemma}\label{prop:good-base-rings-exist}
  If \(k\) is \(\ints\) or \(k\) is a discrete field, then f.p. \(k\)-algebras have choice and witnesses.
  Furthermore, for every finitely generated ideal \(I = (f_1, \ldots, f_n) \subseteq k[X_1, \ldots, X_n]\) the quotient \(k[X_1,\ldots,X_n]/I\) can be constructed as a subset of the polynomial ring \(k[X_1, \ldots, X_n]\).
\end{lemma}
\begin{proof}

  \todo[inline,color=yellow]{via Gröbner basis~\cite{yengui2006,CoxLittleOShea2007}. We can compute one from the ideal description, and obtain representatives for the classes via the multi-variate division algorithm. This allows us in to decide equality in the ideal, implying the witness property.}
\end{proof}


\section{Duality in the strictified model}\label{sec:duality-in-model-of-modal-types}

\Cref{prop:duality-for-k-implies-k-choice-and-witnesses} shows that in this setup, we can only expect to derive a duality axiom base rings \(k\) with choice and witnesses.
In the original model, this is still not sufficient.
We only sketch the issue.

If for example, we want to define the presheaf \(\R[X]\), we would like to define it at level \(M\) by a subset of \(\Term_{\Alg[M]}(X)\).
This is possible since by \Cref{rem:choice-and-witness-property-descend}, \(M\)-algebras have choice, so the canonical map \(\Term_{\Alg[M]}(X) \to M[X]\) splits.
The issue is that if \(\alpha \colon M \to N\) is a homomorphism, then the chosen sections for \(M, N\) do not commute with the restriction actions.
In essence, we can define the homotopy quotient \(R[X]\) of \(\Term_{\R}(X)\) levelwise, but not in a coherent way, which is needed in the na{\"\i}ve cubical presheaf model.
To resolve this, we use the modality \(D\) from~\cite{CRS21} and pass to the model of \(D\)-modal types.
In this model, the quotient can be characterized levelwise.

Before we state the theorem recall that the model of \(D\)-modal types on \([\Alg*[k], \cSet]\) has all higher inductive types by the construction in \cite{CRS21}, since the model of fibrant types has all higher inductive types by the results in~\cite{CoquandHM18}.
Hence, the homotopy quotients considered below exist.

\begin{theorem}
  In the model of \(D\)-modal types on \([\Alg*[k], \cSet]\) the duality axiom holds exactly if all \(k\)-algebras have choice and witnesses.
\end{theorem}
\begin{proof}
  For all types in the image of \(\Delta \colon [\Alg*[k], \Set] \to [\Alg*[k], \cSet]\) are levelwise constant, and therefore modal by \Cref{prop:levelwise-constant-presheaves-are-modal}.
  Hence, we can deduce as in the proof of \Cref{prop:duality-for-k-implies-k-choice-and-witnesses} that duality holds exactly if for all presentations \((n, m, p) \colon \Delta\Pr\) we have that the following is a homotopy quotient of \(\Delta \Term_\R(X_1, \ldots, X_n)\) by the relation induced by the presentation.
  \[\begin{tikzcd}
    {\frac{\Delta \Term_\R(X_1, \ldots, X_n)}{\trunc{\Delta (R_{(n,m,p)})_k}}} && {\Delta\paren[\bigg]{\frac{k[X_1, \ldots, X_m]}{(p_1, \ldots, p_n)}}}
    \arrow[from=1-1, to=1-3]
    \arrow[from=1-1, to=1-3]
  \end{tikzcd}\]
  Since all involved types are \(D\)-modal, this is the case exactly if we have for each \(M \in C\) that for all \((n, m, p) \colon \Delta \Pr_M\) the following is a homotopy quotient in \(\cSet\) of \(\Delta\Term_M(X_1, \ldots, X_n)\) by the relation induced by the presentation.
  As before, the case for \(M = k\) implies that f.p. \(k\)-algebras have choice and witnesses.
  
  Conversely, by \Cref{prop:psh:levelwise-quotient-if-homotopy-quotient}~\ref{prop:psh:levelwise-quotient-if-homotopy-quotient:modal-converse} it suffices to show for all \(M \in \Alg[k]\) that \(\Delta \paren{\sfrac{M[X_1, \ldots, X_m]}{p_1, \ldots, p_n}}\) is a homotopy quotient of \(\Delta\Term_{M}(X_1, \ldots, X_n)\) by the relation \(\Delta R_{(n,m,p)}\) in a context with a finite \(M\)-algebra presentation \((n,m,p) \colon \Delta \Pr_M\).
  By \Cref{prop:set-relevant-quotient-is-homotopy-quotient-iff-surjection-splits-and-witnesses-exist} this is the case if \(M\)-algebras have choice and witnesses, which follows from \Cref{rem:choice-and-witness-property-descend}.
\end{proof}

By \Cref{prop:good-base-rings-exist}, therefore have a number of base rings for which duality holds in \([\Alg*[k], \cSet]\).
In these case we can furthermore construct all objects of interest as subsets of the inductively defined set of terms.
This makes the construction independent of the existence of quotients in the meta theory.

\bibliography{../../util/literature}
\bibliographystyle{plain}

\appendix

\section{Choice and witness properties are hereditary}

We work in a slightly more general setting, to simplify notation.
Let \(\bbT\) be an algebraic theory.
A presentation of a model is a set of equations \(\ell_1, r_1, \ldots \in \Term_{\bbT}(X_1, \ldots)\).
The presented model is \(\Term_{\bbT}(X_1, \ldots) / \sim\) where \(t_0 \sim t_1\) exactly if \(\bbT, \ell_1 \doteq r_1 \vdash t_0 \doteq t_1\).
A model is (finitely) presented if it is isomorphic to a model generated by a presentation (in finitely many variables and equations).
\(\bbT\) has the choice property if the projection onto the presented model splits for all models.
\(\bbT\) has the witness property if from the relation \(\sim\) we can obtain derivations of equality.

If \(M\) is a \(\bbT\)-model define the theory \(\bbT/M\) as \(\bbT\) adjoint constants \(c_m\) for \(m \in M\), and equations \(f(c_{m_1}, \ldots) \doteq c_{f(m_1, \ldots)}\).
We show that if \(\bbT\) has choice and witnesses, then so does \(\bbT/M\) for a finitely presented \(M\).
% Note that for any term \(t \in \Term_{\bbT/M}(\emptyset)\) we have a proof \(\bbT/M \vdash t \doteq c_{[\![t]\!]^M}\) by following the inductive structure of the term.

Let \(M\) be a \(\bbT\)-model presented by \(p_1, q_1, \ldots, q_m, p_m \in \Term_{\bbT}(X_1, \ldots, X_n)\).
By the choice property, there is a function \(\overline{\cdot} \colon \Term_{\bbT/M}(Y_1, \ldots, Y_i) \to \Term_{\bbT}(X_1, \ldots, X_n, Y_1, \ldots, Y_i)\) replacing \(c_m\) by a chosen \(t_m \in \Term_{\bbT}(X_1, \ldots, X_n)\).
There is also a function \(\eta \colon \Term_{\bbT}(X_1, \ldots, X_n, Y_1, \ldots, Y_i) \to \Term_{\bbT/M}(Y_1, \ldots, Y_i)\) defined by \(\eta(Y_k) \coloneqq Y_k\) and \(\eta(X_k) \coloneqq c_{[\![X_k]\!]^M}\) where \([\![X_k]\!]^M\) denotes the image of the term \(X_k \in \Term_{\bbT}(X_1, \ldots, X_n)\) in \(M\).
We have that \(\bbT/M \vdash \eta(t_m) \doteq c_m\) by following the inductive structure of \(t_m\), since \(t_m\) was chosen using the section to \([\![\cdot]\!] \colon \Term_{\bbT}(X_1, \ldots, X_n) \to M\).
From that we conclude that \(\bbT/M \vdash \eta(\overline{t}) \doteq t\).

Suppose we have \(N\) a finitely presented \(\bbT/M\)-model.
This means we have \(i, j \in \nats\) with equations \(\ell_1, r_1, \ldots, \ell_j, r_j \in \Term_{\bbT/M}(Y_1, \ldots, Y_i)\).
By the above we obtain lifts \(\overline\ell_1, \overline r_1, \ldots \in \Term_{\bbT/M}(X_1, \ldots, X_n, Y_1, \ldots, Y_i)\).
These allow us to view \(N\) as a finitely presented \(\bbT\)-model.
Hence, we obtain a choice function \(N \to \Term_{\bbT}(X_1, \ldots, X_n, Y_1, \ldots, Y_i) \xrightarrow{\eta} \Term_{\bbT/M}(Y_1, \ldots, Y_i)\).

We show the witness property for \(\bbT/M\).
Let \(t_0, t_1 \in \Term_{\bbT/M}(Y_1, \ldots, Y_n)\) with equal interpretations in \(N\).
As above, we obtain lifts \(\overline t_0, \overline t_1 \in \Term_{\bbT}(X_1, \ldots, X_n, Y_1, \ldots, Y_n)\).
Since the lifts still coincide when interpreted in \(N\), we obtain a derivation
\[
  \bbT, p_1 \doteq q_1, \ldots, \overline\ell_1 \doteq \overline r_1, \ldots \vdash \overline t_0 \doteq \overline  t_1.
\]
Hence, we obtain a derivation
\[
  \bbT \cup \set{ c_{[\![X_k]\!]} }_{k \leq n}, \eta(p_1) \doteq \eta(q_1), \ldots, \eta(\overline \ell_1) \doteq \eta (\overline r_1), \ldots \vdash \eta (\overline t_0) \doteq \eta (\overline t_1).
\]
Over the larger theory \(\bbT/M \supseteq \bbT \cup \set{ c_{[\![X_k]\!]} }_{k \leq n}\) we have that \(t_i \doteq \eta(\overline{t}_i)\).
Hence, it suffices to show that \(\bbT/M, \ell_1 \doteq r_1, \ldots\) proves the additional assumptions.
From \(\bbT/M \vdash \eta(p_k) \doteq c_{[\![p_k]\!]} = c_{[\![q_k]\!]} \doteq \eta(q_k)\) it follows that the first assumptions are redundant.
From \(\bbT/M, \ell_k \doteq r_k \vdash \eta(\overline\ell_k) \doteq \ell_k \doteq r_k \doteq \eta(\overline{r}_k)\) it follows that the second assumptions are redundant.

\todo[inline]{Add justification that lifted relation has correct universal property. This should follow from the usual semantics for inductive types, and that paths in \(\R\) coincide with strict equality}

\end{document}
