\documentclass[10pt,a4paper]{article}

\usepackage{color}
\newcommand\coloremph[2][red]{\textcolor{#1}{\emph{#2}}}

\newcommand\greenemph[2][green]{\textcolor{#1}{\emph{#2}}}
\newcommand{\EMP}[1]{\emph{\textcolor{red}{#1}}}

\usepackage{url}
\usepackage{verbatim}
\usepackage{latexsym}
\usepackage{amssymb,amstext,amsmath,mathtools,amsthm}
\usepackage{epsf}
\usepackage{epsfig}
\usepackage{a4wide}
\usepackage{verbatim}
\usepackage{proof}
\usepackage{latexsym}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{proposition}{Proposition}[section]
\newcommand{\ras}{\twoheadrightarrow}

\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

%%%%%%%%%
\def\oge{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\langle\!\langle\,$}}
\def\feg{\leavevmode\raise
.3ex\hbox{$\scriptscriptstyle\,\rangle\!\rangle$}}

%%%%%%%%%

\newcommand\myfrac[2]{
 \begin{array}{c}
 #1 \\
 \hline \hline
 #2
\end{array}}


\newcommand{\nats}{\mathbb{N}}

\newcommand{\Fin}[1]{T(#1)}

\newcommand{\ODisc}{\mathsf{ODisc}}
\newcommand{\ints}{\mathbb{Z}}
\newcommand{\rats}{\mathbb{Q}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\Stone}{\mathsf{Stone}}
\newcommand{\CHaus}{\mathsf{CHaus}}
\newcommand{\Open}{\mathsf{Open}}
\newcommand{\Closed}{\mathsf{Closed}}
\newcommand{\AbG}{\mathsf{Ab}}
\newcommand{\OAbG}{\mathsf{Ab_{ODisc}}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\ra}{\rightarrow}
\newcommand{\Noo}{\nats_{\infty}}
\newcommand\norm[1]{\left\lVert #1 \right\rVert}
\newcommand\cHH{\check{H}}%\newcommand\cHH{\check{\mathrm{H}}}
\newcommand\disc{\mathsf{disc}}
\newcommand\Min{\mathsf{min}}
\newcommand\Tr{\mathsf{Tr}}
\newcommand\Nm{\mathsf{Nr}}
\newcommand\Nmr{\mathsf{Nrd}}
\newcommand\Hom{\mathsf{Hom}}

\newcommand{\Cat}{\mathsf{Cat}}
\newcommand{\Set}{\mathsf{Set}}
\newcommand{\Alg}{\mathsf{Alg}}

\newcommand\inl{\mathsf{inl}}
\newcommand\inr{\mathsf{inr}}

\newcommand\Ty{\mathsf{Ty}}
\newcommand\El{\mathsf{El}}
\newcommand\p{\mathsf{p}}
\newcommand\q{\mathsf{q}}
\DeclareMathOperator\id{id}
\DeclarePairedDelimiter\gen{\langle}{\rangle}
\DeclarePairedDelimiter\paren{(}{)}
\DeclarePairedDelimiter\set{\{}{\}}
\newcommand\R{\mathsf{R}}
\newcommand\Spec{\mathsf{Spec}}
\newcommand\bbI{\mathbb{I}}

\usepackage{tikz-cd}


\usepackage{todonotes}


\begin{document}

\title{Errata}

\author{Thierry Coquand, Jonas H\"ofer and Christian Sattler}
\date{}
\maketitle

%\rightfooter{}

\section*{Introduction}

We report a mistake (and a way to fix this mistake in important cases) in the construction of a model for the axiom system presented in~\cite{draft}.
A construction for the general cases will be presented in upcoming work.

This model construction has two parts: the first one

Section 8.1 the mistake is in building the presheaf model

It works in the 1-topos case

\section{Separating homotopy and set-level quotients}

As in \cite{draft}, we work with cubical sets.
If $E$ is a set we write $\Delta E$ for the constant cubical set on $E$.
Recall that for a set $E$ and a cubical set $X$ we have a natural bijection between $\widehat{\square}(\Delta E, X)$ and $\Set(S, X_{[0]})$.
As a consequence, elements of a type $A \in \Ty(\Delta\Gamma)$ are in natural bijection with elements of $A_{[0]} \in \Ty(\Gamma)$.

Furthermore, recall that the nerve functor $N \colon \Cat \to \widehat{\square}$ sends a groupoid $G$ to the fibrant cubical set $NG$, so a type in the model on cubical sets.
The objects of this groupoid correspond exactly to the closed elements of this type, and elements of the hom-set $G(x, y)$ corresponds exactly to the closed elements of the type of paths from $x$ to $y$ in $NG$.

Let $R$ be an equivalence relation on $E$.
This defines a (strict) equivalence relation $\Delta R$ on the cubical set $\Delta E$.
There is a projection map $\Delta E \rightarrow \Delta (E/R)$.
We show that this projection map models the homotopy quotients in cubical sets exactly if the axiom of choice holds in the meta theory.

% TODO: claim important externalizations about nerve, and only use later

\begin{proposition}\label{prop:strict-quotient-is-homotopy-quotient-iff-projection-splits}
  The projection map $\Delta E \rightarrow \Delta (E/R)$ defines a quotient of $\Delta E$ by $\Delta R$ in the cubical set model if, and only if, $E\rightarrow E/R$ has section.
\end{proposition}
\begin{proof}
  Suppose first that $\eta \colon E \to E/R$ has a section $s \colon E/R \to E$.
  This means that we internally also have a section of $\Delta\eta \colon \Delta E \to \Delta(E/R)$ interpreted by $\Delta s$, implying in particular that $\Delta \eta$ is surjective in the internal sense.
  Furthermore, since paths in $\Delta (E/R)$ correspond to strict equality, we have that $\Delta R$ is equivalent to the kernel of $\Delta\eta$.
  These two properties already characterize the quotient~\cite[Theorem~18.2.3]{rijke2025intro}.

  Conversely, suppose that $\Delta\eta \colon \Delta E \to \Delta(E/R)$ has the universal property of the quotient internally.
  We view $E$ as a groupoid with objects $E$ and an invertible morphism between two objects exactly if they are related by $R$.
  Internally, we have a (closed) function $p \colon \Delta E \to NE$ uniquely determined by the identity $E \to (NE)_{[0]} = E$.
  Furthermore, we have that the kernel of this map contains $\Delta R$ because $\Delta R(e_0, e_1) \to pe_0 \simeq pe_1$ holds for all $e_0, e_1 \colon \Delta E$ (in the empty context).
  Hence, we get a map $\overline{p} \colon \Delta(E/R) \to NE$ and a homotopy $\overline p \circ \Delta\eta \sim p$.
  \[\begin{tikzcd}
    \Delta E \arrow[dd, "\Delta\eta"'] \arrow[rr, "p"] &  & NE &                      & E \arrow[dd, "\eta"'] \arrow[rr, "\id_E"]        &  & {(NE)_{[0]}} \\
                                                      &  &    & \leftrightsquigarrow &                                                  &  &              \\
    \Delta (E/R) \arrow[rruu, "\overline p"', dashed]  &  &    &                      & E/R \arrow[rruu, "{\overline p_{[0]}}"', dashed] &  &             
  \end{tikzcd}\]
  This means we have a map on points $\overline{p}_{[0]} \colon E/R \to E$ that we claim to be a section of \(\eta\).
  Note that the triangle on the right commutes only up to $R$.
  Thus, for some $e \in E$ we have that $e \sim s (\eta e)$, and therefore that $\eta e = \eta (s (\eta e))$ showing that $s\eta = \id$ by the universal property of the quotient.
  % \todo[inline]{Simplify this direction by simply using the above bijections.}
  % Conversely, suppose that $\Delta\eta \colon \Delta E \to \Delta(E/R)$ has the universal property of the quotient internally.
  % We view $E$ as a groupoid with objects $E$ and an invertible morphism between two objects exactly if they are related by $R$.
  % The nerve of this groupoid $NE$ is a fibrant cubical set.
  % This fibrant cubical set admits a map $p \colon \Delta E \to NE$ uniquely determined by the identity function $E \to E = (NE)([0])$.
  % Furthermore, we have that the kernel of this map contains $\Delta R$ since we have an element of $\El(\Delta E. \Delta E. \Delta R, p(\q\p) = p(\q\p^2))$ exactly if for all $e_0, e_1 \in E$ satisfying $R(e_0, e_1)$ we have an element of $NE(e_0, e_1)$ which is defined as the subsingleton $R(e_0, e_1)$.
  % Hence, we get a map $\Delta(E/R) \to NE$ with $\overline p \circ \Delta\eta \sim p$.
  % This means we have a map on points $\overline{p}_{[0]} \colon E/R \to E$ that we claim to be a section of \(\eta\).
  % Externally, we have an element of $\El(\Delta E, \overline p (\Delta\eta\q) =_{NE} p\q)$ meaning that for each $e \in E$ we have $R(\overline p_{[0]}(\eta e), e)$ which implies that $\eta \overline{p}_{[0]} = \id_{E/R}$.
\end{proof}

We now show that the duality axiom, for the generic ring as defined in the paper, implies in certain cases a constructive taboo.
In the next section, we will focus on those special cases that avoid this taboo.
The upcoming work will circumvent this taboo by changing the definition of the generic ring, by changing the definition of the base category instead.

We now show that if the duality axioms holds for all base-rings, then the law of the excluded middle already holds in the meta theory.
For that, we conclude a choice like principle from the axiom.

\begin{proposition}\label{prop:strict-duality-implies-lem}
  If for a ring $k$ the duality axiom holds in $\widehat{k\text{-}\Alg_{fp} \times \square}$ with the generic ring is interpreted as in the paper, then for all finite lists of elements $u_1, \ldots, u_n \in k$ the projection $k \to k /(u_1, \ldots, u_n)$ splits.
\end{proposition}
\begin{proof}
  By assumption, the duality axiom holds in the model over the base-ring $k$.
  We write $\R$ for the generic ring in $\widehat{k\textsf{-Alg}_{fp}}$ and $\Delta\R$ for the generic ring in $\widehat{k\textsf{-Alg}_{fp} \times \square}$.
  We have elements of $\R$ and $\Delta \R$ given by $u_1, \ldots, u_n$.
  Hence, we have that $\R/I$ is for $I \coloneqq (u_1, \ldots, u_n)$ a finitely presented $\R$-algebra in the internal sense, and similarly for $\Delta \R$.
  Hence, by duality, we obtain that the top map in the following diagram is an equivalence, where $\Delta \R/I$ denotes the $\Delta\R$-algebra constructed as a homotopy quotient.
  \[\begin{tikzcd}
    \Delta\R/I \arrow[dd] \arrow[rr]                &  & \Delta\R^{\Spec\paren{\R/I}} \\
                                                   &  &                                  \\
    \Delta\paren[\big]{\R/I} \arrow[rruu] &  &                                 
  \end{tikzcd}\]
  Because $\Delta\R$ is, by definition, a strict cubical presheaf, the spectrum of an algebra is equivalent to a strict cubical presheaf as-well (because it can be defined just in terms of elements of $\Delta \R$ and paths in $\Delta \R$ which coincide with strict equality).
  Thus, $\Delta\R^{\Spec\paren{\R/I}}$ is isomorphic to a strict cubical presheaf as-well.
  By the arguments in Section 8.1 of the paper, we have that the duality axiom holds in $\widehat{k\textsf{-Alg}_{fp}}$.
  Hence, we obtain an isomorphism $\R/I \to \R^{\Spec(\R / I)}$ in $\widehat{k\textsf{-Alg}_{fp}}$.
  The diagonal map in the above diagram, is the image of this isomorphism under \(\Delta\).
  Direct inspection show that this triangle commutes.
  By 2-out-of-3 for equivalences, we obtain that the left map is an equivalence.

  We consider the component of this map at $k$.
  Since evaluation preserves equivalences, and homotopy quotients, we obtain that the following canonical map is an equivalence.
  \[\begin{tikzcd}
    \Delta k/(u_1, \ldots, u_n) \arrow[rr] & & \Delta\paren[\big]{k/(u_1, \ldots, u_n)}                            
  \end{tikzcd}\]
  Hence, by Proposition~\ref{prop:strict-quotient-is-homotopy-quotient-iff-projection-splits}, we have that the underlying map in sets $k \to k/(u_1, \ldots, u_n)$ splits. 
\end{proof}

The following is now an adaptation of an argument by Diaconescu~\cite{diaconescu1975choice}.

\begin{corollary}
  If for all rings \(k\) the duality axiom holds in \(\widehat{k\text{-}\Alg_{fp} \times \square}\) with the generic ring is interpreted as in the paper, then all propositions are decidable.
\end{corollary}
\begin{proof}
  Following the techniques in~\cite{mines}, we can show that for any set $E$ and any ring $R$ the canonical map $E \to R[E]$ is injective.

  Let $p$ be a proposition and $P \coloneqq \set{0,1} / \sim_p$.
  We consider the base-ring $k \coloneqq \ints_2[P + P]$.
  By the arguments in the errata, the map $\eta \colon \ints_2[P + P] \to \ints_2[P + P] / (\inl(0) - \inr(0))$ splits.
  Denote the section by $s : \ints_2[P + P] / (\inl(0) - \inr(0)) \to \ints_2[P + P]$.

  For $\inl(1) \in \ints_2[P + P]$ we have that $\eta(\inl(1)) = \eta(s(\eta(\inl(1))))$ since s is a section of $\eta$.
  Thus, there exists some $n \in \ints_2$ with $\inl(1) - s(\eta(\inl(1))) = n(\inr(0) - \inr(1))$.
  If $n = 0$ then we have $\inl(1) = s(\eta(\inl(1)))$.
  If $n = 1$ then we have $\inl(1) + \inr(1) = \inr(0) + s(\eta(\inl(1)))$.
  Since $\inl(i) \ne \inr(j)$ for all $i, j$ in $k$ (by injectivity of $P + P \hookrightarrow k$ and the same fact in $P + P$), we have that $\inr(1) = \inr(0)$.
  Hence, $0 = 1$ in $P$ and therefore $p$ holds.

  Thus, we have $p$ or $\inl(1) = s(\eta(\inl(1)))$.
  Similarly, we can show that $p$ or $\inr(1) = s(\eta(\inr(1)))$.
  Our goal is to show $p$ or not $p$.
  So suppose we are in the case in which $\inl(1) = s(\eta(\inl(1)))$ and $\inr(1) = s(\eta(\inr(1)))$.
  We claim not $p$, so suppose that we have $p$ with the goal of a contradiction.
  Since $p$ holds, we have that
  \[
    \inl(1) = s(\eta(\inl(1))) = s(\eta(\inl(0))) = s(\eta(\inr(0))) = s(\eta(\inr(1))) = \inr(1).
  \]
  This is a contradiction since $\inl(1) \ne \inr(1)$.
\end{proof}


\section{Case where $k$ is $\ints$ or a discrete field}

The above shows that we cannot expect a model on $\widehat{k\text{-}\Alg_{fp} \times \square}$ without choice for set-level quotients of $k$.
In cases where $k$ is well-behaved we can still expect this in our constructive meta theory.
Recall that a field $k$ is \emph{discrete} if for all $u \in k$ we have $u = 0$ or $u$ that is invertible, which is equivalent to $k$ having decidable equality~\cite{mines}.
In this case, we can construct $k[X_1, \ldots, X_n]$ as linear combinations of monomials with non-zero coefficients.

\begin{lemma}
  If $k$ is $\ints$ or $k$ is a discrete field, then for every finitely generated ideal $I = (f_1, \ldots, f_n) \subseteq k[X_1, \ldots, X_n]$ the quotient $k[X_1,\ldots,X_n]/I$ can be constructed as a subset of the polynomial ring $k[X_1, \ldots, X_n]$, and the canonical projection splits.
\end{lemma}
\begin{proof}
  \todo[inline]{via Gröbner basis. We can compute one from the ideal description, and obtain representatives for the classes via the multi-variate division algorithm.}
\end{proof}

The above sufficient condition will guarantee a model for base the rings given by $\ints$, and finite field extensions of $\rats$, and finite fields $\mathbb F_n$.
Crucially, it does not include real, or complex numbers.
Furthermore, the way we constructed the polynomial ring, and the quotient makes the entire construction independent of the availability of quotients in the meta theory.


\subsection{A strictness issue}

Proposition~\ref{prop:strict-quotient-is-homotopy-quotient-iff-projection-splits}  characterizes (closed) homotopy quotients in $\widehat\square$ in terms of choice in $\Set$, we do not obtain a similar characterization for quotients in the na\"ive cubical presheaf model on $\widehat{k\text{-}\Alg_{fp} \times \square}$.
\todo[inline]{Outline that we can define the components of a natural transformation, but they won't be strictly natural. Essentially: a quotient in presheaves is not a levelwise quotient}

\subsection{Strictification}

Let $D$ be the modality from \cite{CRS21}.
We consider the CwF-morphism $\Delta \colon \widehat{k\text{-}\Alg_{fp}} \to \widehat{k\text{-}\Alg_{fp} \times \square}$.
This morphism sends types to fibrant, and $D$-modal types.

We define the generic ring as $\Delta\R$.
To define the polynomial ring in finitely many variables, not that we have $\R[-] \in \Ty_{\widehat{k\text{-}\Alg_{fp}}}(\nats)$.
Thus, we obtain $\Delta(\R[-]) \in \Ty_{\widehat{k\text{-}\Alg_{fp} \times \square}}(\nats)$.
We lift operations by defining them in the generic context.
For example, for the map $\R \to \R[n]$ we consider the corresponding element $\El_{\widehat{k\text{-}\Alg_{fp}}}(\nats.\R, \R[-])$ yielding $\El_{\widehat{k\text{-}\Alg_{fp}\times \square}}(\nats.\Delta\R, \Delta R[-])$.
Similarly, we can lift all operations valued in the polynomial ring, but not its universal property.

The model of $D$-modal, fibrant types on $\widehat{k\text{-}\Alg_{fp} \times \square}$ has all higher inductive types by the construction in \cite{CRS21}, since the model of fibrant types has all higher inductive types by the results in \cite{CoquandHM18}.
Hence, we can construct the polynomial ring $(\Delta\R)[n]$ for each $n \colon \nats$ directly.
Thus, we obtain a comparison map $(\Delta\R)[n] \to \Delta(\R[n])$ commuting with all operations by its universal property.
We show that $\Delta(\R[n])$ has the universal property by showing that this map is an equivalence.

Between $D$-modal types, a map is an equivalence exactly if it is levelwise an equivalence.
Hence, it suffices to check for each $M \in k\text{-}\Alg_{fp}$ that the above map is sent to an equivalence in $\widehat{\square}$ by the CwF-morphism that is evaluation at $M$.
\todo[inline]{Here we now need that the HIT is sent (up to equivalence) to the correct object in $\widehat\square$. Then we can conclude because both types have the same universal property: the HIT by preservation under evaluation, and the strict one by the splitting lemma (or rather a version in a non-empty context). The case for quotients is then similar. Duality is free for the strict objects.}


% Whats the plan? Sending a presheaf on k-Alg to a cubical one lands in fibrant, and D-modal types.
% Does this suffice for the dependent types?
% Take, for example, n:N |- R[n] in PSh(k-Alg). Then we get N |- Delta R[n] in cubical presheaves. (this is not obviously correct)
% 


\todo[inline]{}

 We have to use cobar. % We can levelwise build the map in cubical sets as described above, but they are only natural up to homotopy


A(p), R[X] is not described correctly
we don't clearly get that it has the desired universal property

We can even derive EM from


-problem general case

-if no quotient k = Z or k discrete field needs cobar

\section{An example where it works}

-distributive lattice


\bibliography{../../util/literature}
\bibliographystyle{plain}

\end{document}
